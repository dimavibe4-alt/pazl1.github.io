<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ПАЗЛ — Интерактивная навигация</title>
<style>
  :root{
    --glow:#ffc64d;
    --hoverFill: rgba(255,198,77,.12);
    --bg:#0f1622;
    --fg:#e9edf3;
    --tooltip-bg: linear-gradient(135deg, #1a2b47, #2c3e50);
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; padding:0;}
  body{
    background: radial-gradient(1200px 1200px at 50% -200px,#1b2636 0%,#0f1622 40%,#0b111c 100%), var(--bg);
    color:var(--fg); 
    display:flex; 
    flex-direction: column;
    align-items:center; 
    justify-content:center;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    overflow:hidden;
    padding: 10px;
  }
  
  .header {
    text-align: center;
    margin-bottom: 20px;
    animation: fadeInDown 1s ease-out;
    flex-shrink: 0;
  }
  
  .welcome {
    font-size: 2rem;
    font-weight: 700;
    color: #ffc64d;
    margin: 0;
    text-shadow: 0 0 10px rgba(255,198,77,0.5);
    letter-spacing: 1px;
  }
  
  .scene-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-height: 70vh;
    transform: scale(0.7);
    transform-origin: center center;
  }
  
  .stage{
    position:relative;
    width:min(80vw, 700px);
    aspect-ratio: 1/1;
    user-select:none;
    filter: drop-shadow(0 22px 40px rgba(0,0,0,.55));
    flex-shrink: 0;
  }
  
  .base{
    position:absolute; 
    inset:0;
    width:100%; 
    height:100%;
    object-fit:contain;
    z-index:0;
    pointer-events:none;
  }
  
  .layer{ 
    position:absolute; 
    inset:0; 
    z-index:1; 
  }

  .slogan {
    text-align: center;
    margin-top: 20px;
    animation: fadeInUp 1s ease-out 0.5s both;
    flex-shrink: 0;
  }
  
  .slogan-text {
    font-size: 1.5rem;
    font-weight: 600;
    color: #e9edf3;
    margin: 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    position: relative;
    display: inline-block;
  }
  
  .slogan-text::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 10%;
    width: 80%;
    height: 2px;
    background: linear-gradient(90deg, transparent, #ffc64d, transparent);
    border-radius: 2px;
  }

  /* Анимации для текста */
  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Стили для фрагментов */
  .piece {
    position:absolute;
    transform-origin:center;
    outline:none;
    cursor:pointer;
    pointer-events:none;
  }

  .piece img {
    width:100%;
    height:100%;
    display:block;
    object-fit:contain;
    pointer-events:none;
    transition: all 0.3s ease;
  }

  /* Невидимая активационная зона */
  .piece::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 60%;
    height: 60%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    background: transparent;
    pointer-events: auto;
    z-index: 2;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  /* Анимация при наведении на активационную зону */
  .piece:hover::before {
    animation: pulse-zone 1.5s ease-in-out infinite;
  }

  .piece:hover img {
    animation: pulse 1.1s ease-in-out infinite;
    filter: drop-shadow(0 0 8px var(--glow))
           drop-shadow(0 0 18px rgba(255,198,77,.55));
  }

  @keyframes pulse {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  @keyframes pulse-zone {
    0%   { box-shadow: 0 0 0 0 rgba(255,198,77,0.4); }
    70%  { box-shadow: 0 0 0 15px rgba(255,198,77,0); }
    100% { box-shadow: 0 0 0 0 rgba(255,198,77,0); }
  }

  /* Стили для подсказок */
  .tooltip {
    position: fixed;
    background: var(--tooltip-bg);
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
    z-index: 10000;
    pointer-events: none;
    opacity: 0;
    transform: translateY(20px) scale(0.9);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 8px 30px rgba(0,0,0,0.4), 
                0 0 0 1px rgba(255,198,77,0.2),
                0 0 20px rgba(255,198,77,0.1);
    border: 1px solid rgba(255,198,77,0.3);
    backdrop-filter: blur(10px);
  }

  .tooltip::before {
    content: '';
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 12px;
    height: 12px;
    background: var(--tooltip-bg);
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
  }

  .tooltip::after {
    content: '';
    position: absolute;
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid #1a2b47;
  }

  .tooltip.show {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  @keyframes tooltipAppear {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.9);
    }
    70% {
      transform: translateY(-5px) scale(1.02);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .tooltip.show {
    animation: tooltipAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }

  .tooltip.glow {
    box-shadow: 0 8px 30px rgba(0,0,0,0.4), 
                0 0 0 1px rgba(255,198,77,0.3),
                0 0 30px rgba(255,198,77,0.2);
  }
</style>
</head>
<body>
  <!-- Приветствие над изображением -->
  <div class="header">
    <h1 class="welcome">Добро пожаловать в ПАЗЛ</h1>
  </div>

  <div class="scene-container">
    <div class="stage" id="stage">
      <!-- ОРИГИНАЛ -->
      <img id="base" class="base" src="пазл.png" alt="Исходное изображение"/>

      <!-- СЛОЙ ФРАГМЕНТОВ -->
      <div class="layer" id="layer" aria-label="Интерактивные фрагменты"></div>
    </div>
  </div>

  <!-- Слоган под изображением -->
  <div class="slogan">
    <p class="slogan-text">ПАЗЛ - каждая шина на своем месте</p>
  </div>

  <!-- Общий контейнер для подсказок -->
  <div id="tooltipContainer"></div>

<script>
// Адаптированный массив фрагментов согласно требованиям
const pieces = [
  // Без имени1.png -> Главный экран
  { 
    id:'main', 
    src:'Без имени1.png', 
    title:'Главный экран', 
    href:'slide3.html', 
    x: 135, y: 145, w: 310, h: 310 
  },
  // Без имени2.png -> Прогноз потребности
  { 
    id:'forecast', 
    src:'Без имени2.png', 
    title:'Прогноз потребности', 
    href:'forecast.html', 
    x: 236, y: 347, w: 265, h: 265 
  },
  // Без имени3.png -> Аналитика
  { 
    id:'analytics', 
    src:'Без имени3.png', 
    title:'Аналитика', 
    href:'analytics.html', 
    x: 370, y: 275, w: 210, h: 210 
  },
  // Без имени4.png -> Блок шинного инженера
  { 
    id:'engineer', 
    src:'Без имени4.png', 
    title:'Блок шинного инженера', 
    href:'engineer.html', 
    x: 365, y: 110, w: 220, h: 220 
  },
  // Без имени5.png -> Мониторинг
  { 
    id:'monitoring', 
    src:'Без имени5.png', 
    title:'Мониторинг', 
    href:'monitoring.html', 
    x: 277, y: 7, w: 210, h: 210 
  },
  // Без имени6.png -> Конструктор отчетов
  { 
    id:'constructor', 
    src:'Без имени6.png', 
    title:'Конструктор отчетов', 
    href:'constructor.html', 
    x: 77, y: 365, w: 229, h: 229 
  },
  // Без имени7.png -> Качество дорог
  { 
    id:'quality', 
    src:'Без имени7.png', 
    title:'Качество дорог', 
    href:'quality.html', 
    x: -20, y: 245, w: 240, h: 240 
  },
  // Без имени8.png -> Документы и литература
  { 
    id:'documents', 
    src:'Без имени8.png', 
    title:'Документы и литература', 
    href:'documents.html', 
    x: 0, y: 95, w: 210, h: 210 
  },
  // Без имени9.png -> Блок учета
  { 
    id:'accounting', 
    src:'Без имени9.png', 
    title:'Блок учета', 
    href:'accounting.html', 
    x: 92, y: -10, w: 240, h: 240 
  }
];

const base = document.getElementById('base');
const layer = document.getElementById('layer');
const stage = document.getElementById('stage');
const tooltipContainer = document.getElementById('tooltipContainer');

let naturalW = 0, naturalH = 0;
let currentTooltip = null;
let tooltipTimeout = null;
let currentHoverElement = null;

base.addEventListener('load', () => {
  naturalW = base.naturalWidth;
  naturalH = base.naturalHeight;

  // Если исходник не квадрат — подстраиваем aspect-ratio сцены
  stage.style.aspectRatio = `${naturalW} / ${naturalH}`;

  renderPieces();
  updateLayout();
  window.addEventListener('resize', updateLayout);
});

function renderPieces(){
  layer.innerHTML = '';
  
  pieces.forEach((p, index) => {
    const el = document.createElement('div');
    el.className = 'piece';
    el.tabIndex = 0;
    el.dataset.title = p.title || '';
    el.setAttribute('role','button');
    el.setAttribute('aria-label', p.title || 'Фрагмент');
    
    // Уникальный ID для каждого фрагмента
    el.id = `piece-${p.id || index}`;

    const img = document.createElement('img');
    img.decoding = 'async';
    img.src = p.src;
    img.alt = p.title || 'Фрагмент';
    img.loading = 'lazy';

    el.appendChild(img);
    
    // Обработчики для подсказки - УЛУЧШЕННАЯ ЛОГИКА
    el.addEventListener('mouseenter', (e) => {
      // Если уже есть активная подсказка, скрываем её
      if (currentHoverElement && currentHoverElement !== el) {
        clearTimeout(tooltipTimeout);
        hideTooltip();
      }
      
      currentHoverElement = el;
      clearTimeout(tooltipTimeout);
      tooltipTimeout = setTimeout(() => showTooltip(e, p.title), 300);
    });
    
    el.addEventListener('mouseleave', (e) => {
      // Проверяем, действительно ли мышь покинула элемент
      const relatedTarget = e.relatedTarget;
      if (!el.contains(relatedTarget) && relatedTarget !== el) {
        clearTimeout(tooltipTimeout);
        hideTooltip();
        currentHoverElement = null;
      }
    });
    
    el.addEventListener('mousemove', (e) => {
      // Обновляем позицию подсказки при движении мыши
      if (currentTooltip && currentHoverElement === el) {
        updateTooltipPosition(e);
      }
    });
    
    el.addEventListener('focus', (e) => {
      currentHoverElement = el;
      showTooltip(e, p.title);
    });
    
    el.addEventListener('blur', () => {
      if (currentHoverElement === el) {
        hideTooltip();
        currentHoverElement = null;
      }
    });
    
    // Обработчик клика
    el.addEventListener('click', (e) => {
      e.preventDefault();
      if(p.href && p.href !== '#') {
        window.location.href = p.href;
      }
    });
    
    // Обработчик клавиатуры
    el.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        el.click();
      }
    });

    // Сохраняем геометрию для масштабирования
    el.dataset.mode = 'crop';
    el.dataset.x = p.x;
    el.dataset.y = p.y;
    el.dataset.w = p.w;
    el.dataset.h = p.h;

    layer.appendChild(el);
  });
}

function showTooltip(event, title) {
  // Если уже есть активная подсказка, скрываем её
  if (currentTooltip) {
    hideTooltip();
  }
  
  // Создаем новую подсказку
  currentTooltip = document.createElement('div');
  currentTooltip.className = 'tooltip';
  currentTooltip.textContent = title;
  
  // Добавляем в контейнер
  tooltipContainer.appendChild(currentTooltip);
  
  // Позиционируем подсказку
  updateTooltipPosition(event);
  
  // Показываем подсказку
  setTimeout(() => {
    if (currentTooltip && currentHoverElement) {
      currentTooltip.classList.add('show', 'glow');
    }
  }, 10);
}

function hideTooltip() {
  if (currentTooltip) {
    currentTooltip.classList.remove('show', 'glow');
    setTimeout(() => {
      if (currentTooltip && currentTooltip.parentNode) {
        currentTooltip.parentNode.removeChild(currentTooltip);
      }
      currentTooltip = null;
    }, 300);
  }
}

function updateTooltipPosition(event) {
  if (!currentTooltip) return;
  
  const tooltip = currentTooltip;
  const tooltipRect = tooltip.getBoundingClientRect();
  
  // Определяем позицию мыши или элемента
  let x, y;
  
  if (event.type === 'mousemove' || event.type === 'mouseenter') {
    x = event.clientX;
    y = event.clientY;
  } else {
    // Для фокуса с клавиатуры - позиционируем по центру элемента
    const elRect = event.currentTarget.getBoundingClientRect();
    x = elRect.left + elRect.width / 2;
    y = elRect.top + elRect.height / 2;
  }
  
  // Позиционируем подсказку над курсором/элементом
  let tooltipX = x - tooltipRect.width / 2;
  let tooltipY = y - tooltipRect.height - 20;
  
  // Проверяем границы экрана
  const margin = 10;
  
  if (tooltipX < margin) {
    tooltipX = margin;
  } else if (tooltipX + tooltipRect.width > window.innerWidth - margin) {
    tooltipX = window.innerWidth - tooltipRect.width - margin;
  }
  
  if (tooltipY < margin) {
    tooltipY = y + 20;
  }
  
  tooltip.style.left = tooltipX + 'px';
  tooltip.style.top = tooltipY + 'px';
}

function updateLayout(){
  const rect = layer.getBoundingClientRect();
  const scaleX = rect.width / naturalW;
  const scaleY = rect.height / naturalH;

  Array.from(layer.children).forEach(el => {
    const x = parseFloat(el.dataset.x || 0);
    const y = parseFloat(el.dataset.y || 0);
    const w = parseFloat(el.dataset.w || 0);
    const h = parseFloat(el.dataset.h || 0);
    
    el.style.left = (x * scaleX) + 'px';
    el.style.top = (y * scaleY) + 'px';
    el.style.width = (w * scaleX) + 'px';
    el.style.height = (h * scaleY) + 'px';
  });
}

// Обработчик ошибок загрузки изображений
base.addEventListener('error', () => {
  console.error('Ошибка загрузки основного изображения');
});

// Добавляем CSS переменную для позиционирования стрелки
document.documentElement.style.setProperty('--arrow-position', 'top');
</script>
</body>
</html>
