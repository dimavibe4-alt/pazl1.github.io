<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–ü–ê–ó–õ ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background-color:#f8f9fa;color:#333;line-height:1.5;overflow-x:hidden;height:100vh}
    .header{background:linear-gradient(135deg,#1a2b47,#2c3e50);color:#fff;padding:1.2rem 2rem;box-shadow:0 2px 10px rgba(0,0,0,.15);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
    .header-title{display:flex;align-items:center;gap:15px}
    .logo-title-container{display:flex;align-items:center;gap:15px}
    .logo{height:100px;width:auto;cursor:pointer;transition:all .5s ease;border-radius:8px;filter:brightness(1) drop-shadow(0 2px 4px rgba(0,0,0,.3));animation:logoEntrance 1s ease-out}
    .logo:hover{transform:scale(1.1) rotate(5deg);filter:brightness(1.2) drop-shadow(0 5px 15px rgba(0,0,0,.4));animation:pulse 1.5s infinite}
    .logo:active{transform:scale(.95) rotate(-5deg);transition:all .1s ease}
    @keyframes pulse{0%{transform:scale(1.1) rotate(5deg)}50%{transform:scale(1.15) rotate(5deg)}100%{transform:scale(1.1) rotate(5deg)}}
    @keyframes logoEntrance{0%{opacity:0;transform:scale(.5) rotate(-180deg)}70%{transform:scale(1.1) rotate(10deg)}100%{opacity:1;transform:scale(1) rotate(0)}}
    .title-text{display:flex;flex-direction:column}
    .header-title h1{font-size:1.8rem;margin-bottom:.3rem}
    .header-title p{font-size:1rem;opacity:.9}
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    select,button{padding:.5rem 1rem;border:1px solid #ccc;border-radius:4px;background:#fff;font-size:.95rem;cursor:pointer;transition:all .2s ease}
    select:hover,button:hover{border-color:#1a2b47;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    button.export{background:#28a745;color:#fff;border-color:#218838}
    button.print{background:#17a2b8;color:#fff;border-color:#138496}
    button.settings{background:#6c757d;color:#fff;border-color:#545b62}
    .container{max-width:1600px;margin:1.5rem auto;padding:0 1.5rem;height:calc(90vh - 150px)}
    .menu-button{background:#1a2b47;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:4px;cursor:pointer;font-weight:bold;display:flex;align-items:center;gap:.5rem;transition:all .3s ease;margin-bottom:1rem}
    .menu-button:hover{background:#2c4061;transform:translateY(-1px)}
    .menu-dropdown{display:none;position:absolute;background:#fff;min-width:220px;box-shadow:0 8px 16px rgba(0,0,0,.15);border-radius:6px;z-index:1000;margin-top:.5rem;border:1px solid #ddd}
    .menu-dropdown.show{display:block}
    .menu-item{padding:.75rem 1.2rem;cursor:pointer;transition:background-color .2s;display:flex;align-items:center;gap:.7rem;font-size:.95rem}
    .menu-item:hover{background:#f8f9fa}
    .menu-item.active{background:#e3f2fd;color:#1a2b47;font-weight:bold}

    /* –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
    .filters-panel {
        display: flex;
        gap: 10px;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        padding: 0.8rem;
        background: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e0e0e0;
    }
    .filter-btn {
        padding: 0.4rem 0.8rem;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.2s ease;
        position: relative;
    }
    .filter-btn:hover {
        border-color: #1a2b47;
        background: #e9ecef;
    }
    .filter-btn.active {
        background: #1a2b47;
        color: #fff;
        border-color: #1a2b47;
    }
    .filter-btn.exclude {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
    }
    .filter-btn.exclude:hover {
        background: #c82333;
        border-color: #bd2130;
    }

    /* –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ú–ê–ö–ï–¢ - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ */
    .monitoring-container{display:flex;gap:1rem;margin-bottom:1rem;width:100%;height:100%}
    .monitoring-main{flex:0 0 60%;background:#fff;border-radius:8px;padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,.08);overflow:hidden;display:flex;flex-direction:column}
    .monitoring-stats{flex:0 0 40%;background:#fff;border-radius:8px;padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,.08);overflow:hidden;display:flex;flex-direction:column}
    .monitoring-main h3,.monitoring-stats h3{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;color:#1a2b47;border-bottom:1px solid #eee;padding-bottom:.5rem;font-size:1rem;flex-shrink:0}

    /* –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï –¢–ê–ë–õ–ò–¶–´ - —É–±—Ä–∞–Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
    .monitoring-table-container{overflow-y:auto;overflow-x:hidden;border:1px solid #e0e0e0;border-radius:8px;background:#fff;width:100%;flex:1}
    .monitoring-table{width:100%;border-collapse:collapse;font-size:.75rem;table-layout:fixed}
    .monitoring-table th,.monitoring-table td{padding:.3rem .4rem;border-bottom:1px solid #e0e0e0;vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center}
    .monitoring-table th{text-align:center;background:#e9ecef;font-weight:600;color:#495057;position:sticky;cursor:pointer;user-select:none;z-index:1}
    /* –î–≤—É—Ö—Å—Ç—Ä–æ—á–Ω–∞—è ¬´–ª–∏–ø–∫–∞—è¬ª —à–∞–ø–∫–∞ */
    .monitoring-table thead tr:first-child th{top:0}
    .monitoring-table thead tr:nth-child(2) th{top:28px}
    .monitoring-table th.sortable:hover{background:#dde1e5}
    .monitoring-table th.sortable::after{content:"‚è∑";opacity:.5;margin-left:5px;font-size:.6rem}
    .monitoring-table th.sortable.asc::after{content:"‚ñ≤";opacity:.8}
    .monitoring-table th.sortable.desc::after{content:"‚ñº";opacity:.8}
    .monitoring-table tr:hover{background:#f8f9fa}
    .monitoring-table tr.selected{background:#e3f2fd!important}

    /* –£–ú–ï–ù–¨–®–ï–ù–ù–´–ï –®–ò–†–ò–ù–´ –ö–û–õ–û–ù–û–ö */
    .model-column{width:12%}
    .number-column{width:10%}
    .skdsh-column{width:8%}
    .tkvch-column{width:10%}
    .pressure-cell{width:8%}

    /* –ù–û–í–´–ï –°–¢–ò–õ–ò –ü–†–ò–û–†–ò–¢–ï–¢–û–í –ò –¢–£–õ–¢–ò–ü–û–í */
    :root{
      --no-truck-gradient: linear-gradient(135deg,#e9ecef,#dee2e6);
      --no-plan-color: #dc3545;
      --excellent-color: #d4edda;
      --good-color: #fff3cd;
      --poor-color: #f8d7da;
    }

    /* 1) –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–∞–º–æ—Å–≤–∞–ª–æ–º ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1, —Å–µ—Ä—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –ø–æ –≤—Å–µ–π —Å—Ç—Ä–æ–∫–µ */
    .row-no-truck {
      background: var(--no-truck-gradient) !important;
      color: #6c757d !important;
    }

    /* 2) –ù–µ—Ç –ø–ª–∞–Ω–∞ ‚Äî –£–õ–£–ß–®–ï–ù–ù–ê–Ø –∞–Ω–∏–º–∞—Ü–∏—è —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–∞–º–∫–æ–π –∏ –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–º —Ç–µ–∫—Å—Ç–æ–º */
    @keyframes border-pulse-inner {
      0%, 100% { box-shadow: inset 0 0 0 2px var(--no-plan-color); }
      50% { box-shadow: inset 0 0 0 3px rgba(220, 53, 69, 0.4); }
    }
    
    @keyframes text-pulse {
      0%, 100% { 
        color: var(--no-plan-color);
        font-weight: bold;
        transform: scale(1);
      }
      50% { 
        color: #ff6b7a;
        font-weight: bolder;
        transform: scale(1.05);
      }
    }
    
    .cell-no-plan {
      position: relative;
      background: transparent !important;
      animation: border-pulse-inner 1.5s infinite !important;
      border-radius: 4px;
    }
    
    .cell-no-plan .no-plan-text {
      animation: text-pulse 1.5s infinite !important;
      font-weight: bold !important;
    }

    /* 3) –ù–µ—Ç —Å–≤—è–∑–∏ —Å –¥–∞—Ç—á–∏–∫–æ–º ‚Äî —Å–µ—Ä—ã–π —Ñ–æ–Ω —è—á–µ–π–∫–∏ + –∏–∫–æ–Ω–∫–∞ */
    .cell-no-sensor {
      background: #f2f3f5 !important;
      color: #6c757d !important;
      position: relative;
    }
    .cell-no-sensor::after{
      content:"üì∂";
      position:absolute; top:2px; right:4px;
      font-size:.7rem; opacity:.8;
    }

    /* 4) –†–∞—Å–∫—Ä–∞—Å–∫–∞ –ø–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º */
    .tkvch-excellent,.pressure-excellent { background: var(--excellent-color) !important; color:#155724 !important; }
    .tkvch-good,.pressure-good { background: var(--good-color) !important; color:#856404 !important; }
    .tkvch-poor,.pressure-poor { background: var(--poor-color) !important; color:#721c24 !important; }
    
    /* –†–∞—Å–∫—Ä–∞—Å–∫–∞ –ö–¢–ì –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ */
    .ktg-excellent { background: var(--excellent-color) !important; color:#155724 !important; }
    .ktg-good { background: var(--good-color) !important; color:#856404 !important; }
    .ktg-poor { background: var(--poor-color) !important; color:#721c24 !important; }

    /* –¢—É–ª—Ç–∏–ø—ã ‚Äî –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω, –ø–æ–≤–µ—Ä—Ö –≤—Å–µ—Ö */
    .tooltip{ 
        position:relative; 
        display:inline-block; 
        cursor:pointer; 
        width:100%;
        height: 100%;
    }

    .tooltip .tooltip-text{
      visibility: hidden;
      position: fixed;
      z-index: 2147483647;
      background: #1a2b47 !important;
      color: #fff !important;
      border: 1px solid rgba(0,0,0,.25);
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
      padding: 12px 15px;
      border-radius: 6px;
      font-size: .8rem; 
      line-height: 1.4;
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      min-width: 300px;
      max-width: 500px;
      white-space: normal;
      word-wrap: break-word;
      text-align: left;
    }

    .tooltip:hover .tooltip-text{
      opacity: 1;
      transform: translateY(0);
      visibility: visible;
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø */
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:0.8rem;margin-top:1rem;flex-shrink:0}
    .stat-card{padding:0.8rem;background:#f8f9fa;border-radius:6px;text-align:center;cursor:pointer;transition:all .2s ease}
    .stat-card:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.1)}
    .stat-card.active{background:#e3f2fd;border:2px solid #1a2b47}
    .stat-card h4{margin-bottom:.4rem;color:#1a2b47;font-size:.8rem}
    .stat-value{font-size:1rem;font-weight:bold;color:#1a2b47}

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ */
    .notification{position:fixed;top:20px;right:20px;padding:15px 20px;background:#28a745;color:white;border-radius:5px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:10000;transition:all .3s ease}
    .notification.error{background:#dc3545}
    .notification.warning{background:#ffc107;color:#212529}
    .update-info{display:flex;align-items:center;gap:8px;font-size:0.75rem;color:#6c757d;flex-wrap:wrap}
    .refresh-btn{background:none;border:none;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s ease;color:#6c757d;font-size:0.8rem}
    .refresh-btn:hover{background:#e9ecef;color:#1a2b47}

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    }
    .modal-overlay.active {
        display: flex;
    }
    .modal {
        background: #fff;
        border-radius: 8px;
        padding: 20px;
        min-width: 500px;
        max-width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
    }
    .modal-body {
        margin-bottom: 15px;
        padding: 10px;
    }
    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    .form-section {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }
    .form-section h4 {
        margin-bottom: 10px;
        color: #1a2b47;
        font-size: 1rem;
    }
    .form-group {
        margin-bottom: 10px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        font-size: 0.9rem;
    }
    .form-control {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 0.9rem;
    }
    .form-row {
        display: flex;
        gap: 10px;
    }
    .form-row .form-group {
        flex: 1;
    }
    .color-preview {
        width: 30px;
        height: 20px;
        border: 1px solid #ccc;
        border-radius: 3px;
        display: inline-block;
        margin-left: 10px;
        vertical-align: middle;
    }
    .animation-preview {
        width: 100%;
        height: 30px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-top: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        position: relative;
        overflow: hidden;
    }
    .threshold-preview {
        display: flex;
        align-items: center;
        margin-top: 5px;
        gap: 5px;
    }
    .threshold-bar {
        height: 10px;
        flex-grow: 1;
        border-radius: 5px;
    }
    .threshold-label {
        font-size: 0.7rem;
        min-width: 40px;
    }
    small {
        color: #6c757d;
        font-size: 0.8rem;
    }
    .btn{padding:.4rem .8rem;border:1px solid;border-radius:4px;cursor:pointer;font-size:.8rem;transition:all .2s ease}
    .btn-primary{background:#1a2b47;color:#fff;border-color:#1a2b47}
    .btn-primary:hover{background:#2c4061;border-color:#2c4061}
    .btn-secondary{background:#6c757d;color:#fff;border-color:#6c757d}
    .btn-secondary:hover{background:#5a6268;border-color:#545b62}

    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    .stats-table-compact th, .stats-table-compact td {
        padding: 0.2rem 0.3rem;
        font-size: 0.7rem;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
    .chart-container {
        height: 250px;
        margin-top: 1rem;
        background: #fff;
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .chart-controls {
        display: flex;
        gap: 5px;
        margin-bottom: 10px;
        flex-wrap: wrap;
    }
    
    .chart-control-btn {
        padding: 0.3rem 0.6rem;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.7rem;
        transition: all 0.2s ease;
    }
    
    .chart-control-btn:hover {
        background: #e9ecef;
    }
    
    .chart-control-btn.active {
        background: #1a2b47;
        color: #fff;
        border-color: #1a2b47;
    }

    .period-selector {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    .period-selector select {
        padding: 0.3rem 0.6rem;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    @media (max-width: 1400px) {
        .monitoring-container {
            gap: 0.8rem;
        }
        .monitoring-main, .monitoring-stats {
            padding: 0.8rem;
        }
        .monitoring-table {
            font-size: 0.7rem;
        }
        .monitoring-table th, .monitoring-table td {
            padding: 0.25rem 0.3rem;
        }
        .model-column{width:14%}
        .number-column{width:12%}
        .skdsh-column{width:10%}
        .tkvch-column{width:12%}
        .pressure-cell{width:8%}
    }

    @media (max-width: 1200px){
        .monitoring-container{flex-direction:column}
        .monitoring-main,.monitoring-stats{flex:1}
        .monitoring-main h3,.monitoring-stats h3{font-size:1.1rem}
        .model-column{width:15%}
        .number-column{width:13%}
        .skdsh-column{width:12%}
        .tkvch-column{width:14%}
        .pressure-cell{width:9%}
    }

    @media (max-width: 992px) {
        .container {
            padding: 0 1rem;
        }
        .monitoring-table {
            font-size: 0.65rem;
        }
        .model-column{width:18%}
        .number-column{width:15%}
        .skdsh-column{width:14%}
        .tkvch-column{width:16%}
        .pressure-cell{width:9%}
        .filters-panel {
            gap: 6px;
        }
        .filter-btn {
            padding: 0.3rem 0.6rem;
            font-size: 0.7rem;
        }
    }

    @media (max-width: 768px){
        .header{padding:.8rem 1rem}
        .header-title h1{font-size:1.3rem}
        .header-title p{font-size:.8rem}
        .controls{width:100%;justify-content:flex-start}
        .header-title{flex-direction:column;align-items:flex-start}
        .logo-title-container{margin-bottom:5px}
        .container{padding:0 .8rem; height:calc(85vh - 150px)}
        .monitoring-table th,.monitoring-table td{padding:.2rem}
        .monitoring-main h3,.monitoring-stats h3{flex-direction:column;align-items:flex-start;gap:8px; font-size:1rem}
        .monitoring-table thead tr:nth-child(2) th{top:26px}
        .tooltip .tooltip-text{min-width:260px;max-width:90vw; font-size: 0.65rem;}
        .stats-grid{grid-template-columns:repeat(auto-fit, minmax(130px, 1fr));gap:0.6rem}
        .stat-card{padding:0.6rem}
        .modal {
            min-width: 95%;
            padding: 15px;
        }
        .form-row {
            flex-direction: column;
            gap: 5px;
        }
        .model-column{width:20%}
        .number-column{width:18%}
        .skdsh-column{width:16%}
        .tkvch-column{width:18%}
        .pressure-cell{width:10%}
        .filters-panel {
            flex-direction: column;
            align-items: flex-start;
        }
    }

    @media (max-width: 576px) {
        .monitoring-table {
            font-size: 0.6rem;
        }
        .monitoring-table th, .monitoring-table td {
            padding: 0.15rem 0.2rem;
        }
        .model-column{width:22%}
        .number-column{width:20%}
        .skdsh-column{width:18%}
        .tkvch-column{width:20%}
        .pressure-cell{width:12%}
        .update-info {
            font-size: 0.7rem;
        }
    }
</style>
</head>
<body>
<div class="header">
    <div class="header-title">
        <div class="logo-title-container">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%231a2b47'/%3E%3Ctext x='50' y='60' font-family='Arial' font-size='24' fill='white' text-anchor='middle'%3E–ü–ê–ó–õ%3C/text%3E%3C/svg%3E" alt="–õ–æ–≥–æ—Ç–∏–ø –ü–ê–ó–õ" class="logo" onclick="window.location.href='slide2.html'">
            <div class="title-text">
                <h1>–ü–ê–ó–õ</h1>
                <p>–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å –ó–æ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –õ–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –°–ö–ì–®</p>
                <p>–£–ö –£–ì–û–õ–¨–ù–´–ô –†–ê–ó–†–ï–ó</p>
            </div>
        </div>
    </div>
    <div class="controls">
        <select id="regionSelect">
            <option>–†–µ–≥–∏–æ–Ω: –í—Å–µ</option><option>–†–µ–≥–∏–æ–Ω 1</option><option>–†–µ–≥–∏–æ–Ω 2</option>
        </select>
        <select id="enterpriseSelect">
            <option>–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ: –í—Å–µ</option><option>–†–∞–∑—Ä–µ–∑ 1</option><option>–†–∞–∑—Ä–µ–∑ 2</option><option>–†–∞–∑—Ä–µ–∑ 3</option>
        </select>
        <button class="export" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button class="print" id="printBtn">–ü–µ—á–∞—Ç—å</button>
        <button class="settings" id="settingsBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>
</div>

<div class="container">
    <button class="menu-button" id="menuButton">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
        </svg>
        –ú–µ–Ω—é —Å–∏—Å—Ç–µ–º—ã
    </button>

 <div class="menu-dropdown" id="menuDropdown">
            <div class="menu-item" onclick="window.location.href='slide3.html'">–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</div>
            <div class="menu-item" onclick="window.location.href='accounting.html'">–ë–ª–æ–∫ —É—á–µ—Ç–∞</div>
            <div class="menu-item active" onclick="window.location.href='monitoring.html'">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</div>
            <div class="menu-item" onclick="window.location.href='engineer.html'">–ë–ª–æ–∫ —à–∏–Ω–Ω–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞</div>
            <div class="menu-item" onclick="window.location.href='analytics.html'">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
            <div class="menu-item" onclick="window.location.href='forecast.html'">–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏</div>
            <div class="menu-item" onclick="window.location.href='constructor.html'">–ö–æ–Ω—Å—Ç—Ä—É–∫–æ—Ä –æ—Ç—á–µ—Ç–æ–≤</div>
            <div class="menu-item" onclick="window.location.href='quality.html'">–ö–∞—á–µ—Å—Ç–≤–æ –¥–æ—Ä–æ–≥</div>
            <div class="menu-item" onclick="window.location.href='documents.html'">–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</div>
        </div>

    <div class="monitoring-container">
        <!-- –õ–ï–í–´–ô –ë–õ–û–ö - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (60%) -->
        <div class="monitoring-main">
            <h3>
                –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                <div class="update-info">
                    <span id="lastUpdateInfo">–û–±–Ω–æ–≤–ª–µ–Ω–æ: --:--:-- (–∞–≤—Ç–æ: 5 –º–∏–Ω)</span>
                    <button class="refresh-btn" id="manualRefreshBtn" title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ">‚ü≥</button>
                </div>
            </h3>
            
            <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="filters-panel">
                <button class="filter-btn" data-filter="exceedTKVCH">–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¢–ö–í–ß</button>
                <button class="filter-btn" data-filter="exceedPressure">–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è</button>
                <button class="filter-btn" data-filter="noPlan">–ù–µ—Ç –ø–ª–∞–Ω–∞</button>
                <button class="filter-btn" data-filter="noTruckConnection">–ù–µ—Ç —Å–≤—è–∑–∏ —Å –ê/–°</button>
                <button class="filter-btn" data-filter="noSensorConnection">–ù–µ—Ç —Å–≤—è–∑–∏ —Å –î–î</button>
                <button class="filter-btn" data-filter="clear">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            </div>
            
            <div class="monitoring-table-container">
                <table class="monitoring-table" id="trucksTable">
                    <colgroup>
                        <col class="model-column">
                        <col class="number-column">
                        <col class="skdsh-column">
                        <col class="tkvch-column">
                        <col class="tkvch-column">
                        <col class="pressure-cell">
                        <col class="pressure-cell">
                        <col class="pressure-cell">
                        <col class="pressure-cell">
                        <col class="pressure-cell">
                        <col class="pressure-cell">
                    </colgroup>
                    <thead>
                        <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —à–∞–ø–∫–∏ -->
                        <tr>
                            <th class="sortable model-column" data-key="model" rowspan="2">–ú–æ–¥–µ–ª—å –ê/–°</th>
                            <th class="sortable number-column" data-key="number" rowspan="2">–ù–æ–º–µ—Ä –ê/–°</th>
                            <th class="sortable skdsh-column" data-key="skdsh" rowspan="2">–°–ö–î–®</th>
                            <th class="sortable tkvch-column" data-key="tkvchFront" rowspan="2">–¢–ö–í–ß –ø–µ—Ä–µ–¥</th>
                            <th class="sortable tkvch-column" data-key="tkvchRear" rowspan="2">–¢–ö–í–ß –∑–∞–¥</th>
                            <th colspan="6" style="text-align:center;">–î–∞–≤–ª–µ–Ω–∏–µ</th>
                        </tr>
                        <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ —à–∞–ø–∫–∏ ‚Äî –ø–æ–∑–∏—Ü–∏–∏ -->
                        <tr>
                            <th class="pressure-cell">–ü–ü</th>
                            <th class="pressure-cell">–ü–õ</th>
                            <th class="pressure-cell">–ó–õ–ù</th>
                            <th class="pressure-cell">–ó–õ–í</th>
                            <th class="pressure-cell">–ó–ü–í</th>
                            <th class="pressure-cell">–ó–ü–ù</th>
                        </tr>
                    </thead>
                    <tbody id="trucksTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- –ü–†–ê–í–´–ô –ë–õ–û–ö - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (40%) -->
        <div class="monitoring-stats">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h3>
            <div class="monitoring-table-container">
                <table class="monitoring-table stats-table-compact" id="statsTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-key="model" rowspan="2">–ú–æ–¥–µ–ª—å –ê/–°</th>
                            <th class="sortable" data-key="truckCount" rowspan="2">–ö–æ–ª-–≤–æ –ê/–°</th>
                            <th colspan="5" style="text-align:center;">–°–ö–î–®/–ö–¢–ì</th>
                        </tr>
                        <tr>
                            <th class="sortable" data-key="total">–í—Å–µ–≥–æ</th>
                            <th class="sortable" data-key="skt">–°–ö–¢</th>
                            <th class="sortable" data-key="eva">EVA</th>
                            <th class="sortable" data-key="koda">–ö–æ–¥–∞</th>
                            <th class="sortable" data-key="prepro">Pre.pro.</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody"></tbody>
                </table>
            </div>
            
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–º -->
            <div class="chart-controls">
                <div class="period-selector">
                    <label for="chartPeriod">–ü–µ—Ä–∏–æ–¥:</label>
                    <select id="chartPeriod" class="form-control">
                        <option value="3">3 –º–µ—Å—è—Ü–∞</option>
                        <option value="6">6 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="12">12 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="24" selected>24 –º–µ—Å—è—Ü–∞</option>
                    </select>
                </div>
               
                <button class="chart-control-btn" data-system="total">–í—Å–µ–≥–æ</button>
                <button class="chart-control-btn" data-system="skt">–°–ö–¢</button>
                <button class="chart-control-btn" data-system="eva">EVA</button>
                <button class="chart-control-btn" data-system="koda">–ö–æ–¥–∞</button>
                <button class="chart-control-btn" data-system="prepro">Pre.pro.</button>
            </div>
            
            <!-- –ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <div class="chart-container">
                <canvas id="statsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
<div class="modal-overlay" id="settingsModal">
    <div class="modal">
        <div class="modal-header">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h3>
            <button class="modal-close" id="closeSettingsModal">&times;</button>
        </div>
        <div class="modal-body">
            <!-- –ù–ê–°–¢–†–û–ô–ö–ê –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò -->
            <div class="form-section">
                <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏</h4>
                
                <!-- –¢–∏–ø –∑–∞–ª–∏–≤–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–≤—è–∑–∏ —Å –ê/–° -->
                <div class="form-group">
                    <label for="noTruckGradientType">–¢–∏–ø –∑–∞–ª–∏–≤–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–≤—è–∑–∏ —Å –ê/–°</label>
                    <select id="noTruckGradientType" class="form-control">
                        <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞</option>
                        <option value="solid">–°–ø–ª–æ—à–Ω–æ–π —Ü–≤–µ—Ç</option>
                        <option value="pattern">–®—Ç—Ä–∏—Ö–æ–≤–∫–∞</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="noTruckGradientStart">–¶–≤–µ—Ç –Ω–∞—á–∞–ª–∞</label>
                        <input type="color" id="noTruckGradientStart" class="form-control" value="#e9ecef">
                        <div class="color-preview" id="noTruckGradientStartPreview" style="background-color: #e9ecef;"></div>
                    </div>
                    <div class="form-group">
                        <label for="noTruckGradientEnd">–¶–≤–µ—Ç –∫–æ–Ω—Ü–∞</label>
                        <input type="color" id="noTruckGradientEnd" class="form-control" value="#dee2e6">
                        <div class="color-preview" id="noTruckGradientEndPreview" style="background-color: #dee2e6;"></div>
                    </div>
                </div>
                
                <!-- –¢–∏–ø –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–ª–∞–Ω–∞ -->
                <div class="form-group">
                    <label for="noPlanAnimation">–¢–∏–ø –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–ª–∞–Ω–∞</label>
                    <select id="noPlanAnimation" class="form-control">
                        <option value="pulse-gentle">–ü–ª–∞–≤–Ω–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è</option>
                        <option value="pulse-strong">–°–∏–ª—å–Ω–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è</option>
                        <option value="glow">–°–≤–µ—á–µ–Ω–∏–µ</option>
                        <option value="breathe">–î—ã—Ö–∞–Ω–∏–µ</option>
                        <option value="shake">–î—Ä–æ–∂–∞–Ω–∏–µ</option>
                        <option value="flash">–ú–∏–≥–∞–Ω–∏–µ</option>
                    </select>
                    <div class="animation-preview" id="animationPreview">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∏–º–∞—Ü–∏–∏</div>
                </div>
                
                <div class="form-group">
                    <label for="noPlanColor">–¶–≤–µ—Ç –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–ª–∞–Ω–∞</label>
                    <input type="color" id="noPlanColor" class="form-control" value="#dc3545">
                    <div class="color-preview" id="noPlanColorPreview" style="background-color: #dc3545;"></div>
                </div>
                
                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="excellentColor">–¶–≤–µ—Ç "–û—Ç–ª–∏—á–Ω–æ"</label>
                        <input type="color" id="excellentColor" class="form-control" value="#d4edda">
                        <div class="color-preview" id="excellentColorPreview" style="background-color: #d4edda;"></div>
                    </div>
                    <div class="form-group">
                        <label for="goodColor">–¶–≤–µ—Ç "–•–æ—Ä–æ—à–æ"</label>
                        <input type="color" id="goodColor" class="form-control" value="#fff3cd">
                        <div class="color-preview" id="goodColorPreview" style="background-color: #fff3cd;"></div>
                    </div>
                    <div class="form-group">
                        <label for="poorColor">–¶–≤–µ—Ç "–ü–ª–æ—Ö–æ"</label>
                        <input type="color" id="poorColor" class="form-control" value="#f8d7da">
                        <div class="color-preview" id="poorColorPreview" style="background-color: #f8d7da;"></div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ—Ä–æ–≥–∏ –ö–¢–ì -->
            <div class="form-section">
                <h4>–ü–æ—Ä–æ–≥–∏ –ö–¢–ì (%)</h4>
                <div class="form-group">
                    <label for="ktgExcellent">–û—Ç–ª–∏—á–Ω—ã–π (–∑–µ–ª–µ–Ω—ã–π) ‚â•</label>
                    <input type="number" id="ktgExcellent" class="form-control" min="0" max="100" value="95">
                </div>
                <div class="form-group">
                    <label for="ktgGood">–•–æ—Ä–æ—à–∏–π (–∂–µ–ª—Ç—ã–π) ‚â•</label>
                    <input type="number" id="ktgGood" class="form-control" min="0" max="100" value="80">
                </div>
                <div class="form-group">
                    <label for="ktgPoor">–ü–ª–æ—Ö–æ–π (–∫—Ä–∞—Å–Ω—ã–π) <</label>
                    <input type="number" id="ktgPoor" class="form-control" min="0" max="100" value="80" disabled>
                    <small>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –Ω–∏–∂–µ —Ö–æ—Ä–æ—à–µ–≥–æ</small>
                </div>
                <div class="threshold-preview">
                    <div class="threshold-label">0%</div>
                    <div class="threshold-bar" id="ktgThresholdBar"></div>
                    <div class="threshold-label">100%</div>
                </div>
            </div>
            
            <!-- –ü–æ—Ä–æ–≥–∏ –¢–ö–í–ß -->
            <div class="form-section">
                <h4>–ü–æ—Ä–æ–≥–∏ –¢–ö–í–ß (¬±¬∞C)</h4>
                <div class="form-group">
                    <label>–ó–µ–ª–µ–Ω—ã–π (–æ—Ç–ª–∏—á–Ω—ã–π)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="number" id="tkvchGreenLower" class="form-control" value="-50" placeholder="–û—Ç">
                        </div>
                        <div class="form-group">
                            <input type="number" id="tkvchGreenUpper" class="form-control" value="50" placeholder="–î–æ">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ñ–µ–ª—Ç—ã–π (—Ö–æ—Ä–æ—à–∏–π)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="number" id="tkvchYellowLower" class="form-control" value="-100" placeholder="–û—Ç">
                        </div>
                        <div class="form-group">
                            <input type="number" id="tkvchYellowUpper" class="form-control" value="100" placeholder="–î–æ">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ö—Ä–∞—Å–Ω—ã–π (–ø–ª–æ—Ö–æ–π)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="number" id="tkvchRedLower" class="form-control" value="-150" placeholder="–û—Ç">
                        </div>
                        <div class="form-group">
                            <input type="number" id="tkvchRedUpper" class="form-control" value="150" placeholder="–î–æ">
                        </div>
                    </div>
                </div>
                <div class="threshold-preview">
                    <div class="threshold-label">-150¬∞C</div>
                    <div class="threshold-bar" id="tkvchThresholdBar"></div>
                    <div class="threshold-label">+150¬∞C</div>
                </div>
            </div>
            
            <!-- –ü–æ—Ä–æ–≥–∏ –¥–∞–≤–ª–µ–Ω–∏—è -->
            <div class="form-section">
                <h4>–ü–æ—Ä–æ–≥–∏ –¥–∞–≤–ª–µ–Ω–∏—è (¬±–±–∞—Ä)</h4>
                <div class="form-group">
                    <label>–ó–µ–ª–µ–Ω—ã–π (–æ—Ç–ª–∏—á–Ω—ã–π)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="number" id="pressureGreenLower" class="form-control" min="0" step="0.1" value="-0.3" placeholder="–û—Ç">
                        </div>
                        <div class="form-group">
                            <input type="number" id="pressureGreenUpper" class="form-control" min="0" step="0.1" value="0.3" placeholder="–î–æ">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ñ–µ–ª—Ç—ã–π (—Ö–æ—Ä–æ—à–∏–π)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="number" id="pressureYellowLower" class="form-control" min="0" step="0.1" value="-0.6" placeholder="–û—Ç">
                        </div>
                        <div class="form-group">
                            <input type="number" id="pressureYellowUpper" class="form-control" min="0" step="0.1" value="0.6" placeholder="–î–æ">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ö—Ä–∞—Å–Ω—ã–π (–ø–ª–æ—Ö–æ–π)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="number" id="pressureRedLower" class="form-control" min="0" step="0.1" value="-1.0" placeholder="–û—Ç">
                        </div>
                        <div class="form-group">
                            <input type="number" id="pressureRedUpper" class="form-control" min="0" step="0.1" value="1.0" placeholder="–î–æ">
                        </div>
                    </div>
                </div>
                <div class="threshold-preview">
                    <div class="threshold-label">-1.0 –±–∞—Ä</div>
                    <div class="threshold-bar" id="pressureThresholdBar"></div>
                    <div class="threshold-label">+1.0 –±–∞—Ä</div>
                </div>
            </div>
            
            <!-- –ü–µ—Ä–∏–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤ -->
            <div class="form-section">
                <h4>–ü–µ—Ä–∏–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤</h4>
                <div class="form-group">
                    <label for="sensorPeriodType">–¢–∏–ø –ø–µ—Ä–∏–æ–¥–∞</label>
                    <select id="sensorPeriodType" class="form-control">
                        <option value="months">–ü–æ –º–µ—Å—è—Ü–∞–º</option>
                        <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                    </select>
                </div>
                <div id="monthsPeriodSection">
                    <div class="form-group">
                        <label for="sensorMonths">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤</label>
                        <select id="sensorMonths" class="form-control">
                            <option value="1">1 –º–µ—Å—è—Ü</option>
                            <option value="2">2 –º–µ—Å—è—Ü–∞</option>
                            <option value="3" selected>3 –º–µ—Å—è—Ü–∞</option>
                            <option value="6">6 –º–µ—Å—è—Ü–∞</option>
                            <option value="12">12 –º–µ—Å—è—Ü–µ–≤</option>
                        </select>
                    </div>
                </div>
                <div id="customPeriodSection" style="display:none">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                            <input type="date" id="startDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="endDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                            <input type="date" id="endDate" class="form-control">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
            <div class="form-section">
                <h4>–ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h4>
                <div class="form-group">
                    <label for="monitoringPeriod">–ü–µ—Ä–∏–æ–¥ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫</label>
                    <select id="monitoringPeriod" class="form-control">
                        <option value="24">24 —á–∞—Å–∞</option>
                        <option value="72" selected>3 –¥–Ω—è</option>
                        <option value="168">7 –¥–Ω–µ–π</option>
                        <option value="720">30 –¥–Ω–µ–π</option>
                    </select>
                    <small>–ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –≤–æ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–∫–∞—Ö</small>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelSettings">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-primary" id="saveSettings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
<div class="modal-overlay" id="exportModal">
    <div class="modal">
        <div class="modal-header">
            <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <button class="modal-close" id="closeExportModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞</label>
                <select id="exportFormat" class="form-control">
                    <option value="pdf">PDF</option>
                    <option value="excel">Excel</option>
                    <option value="word">Word</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="exportFileName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</label>
                <input type="text" id="exportFileName" class="form-control" value="–û—Ç—á–µ—Ç_–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelExport">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-primary" id="confirmExport">–≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—á–∞—Ç–∏ -->
<div class="modal-overlay" id="printModal">
    <div class="modal">
        <div class="modal-header">
            <h3>–ü–µ—á–∞—Ç—å</h3>
            <button class="modal-close" id="closePrintModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–Ω—Ç–µ—Ä</label>
                <select id="printerSelect" class="form-control">
                    <option value="default">–ü—Ä–∏–Ω—Ç–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                    <option value="printer1">–ü—Ä–∏–Ω—Ç–µ—Ä 1</option>
                    <option value="printer2">–ü—Ä–∏–Ω—Ç–µ—Ä 2</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–î–∏–∞–ø–∞–∑–æ–Ω –ø–µ—á–∞—Ç–∏</label>
                <select id="printRange" class="form-control">
                    <option value="all">–í—Å–µ –¥–∞–Ω–Ω—ã–µ</option>
                    <option value="current">–¢–µ–∫—É—â–∏–π –≤–∏–¥</option>
                    <option value="selected">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="copies">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π</label>
                <input type="number" id="copies" class="form-control" min="1" value="1">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelPrint">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-primary" id="confirmPrint">–ü–µ—á–∞—Ç—å</button>
        </div>
    </div>
</div>

<script>
/* === –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–∫–∞–∫ –≤ XLSX) === */
const POS_LABELS = ['–ü–ü','–ü–õ','–ó–õ–ù','–ó–õ–í','–ó–ü–í','–ó–ü–ù'];
const MODELS = {
    '75131': { capacity: 130, volume: 102, type: '—Å–æ—Ç–∫–∏', normTKVCH: 700 },
    '7513D': { capacity: 130, volume: 102, type: '—Å–æ—Ç–∫–∏', normTKVCH: 700 },
    '75306': { capacity: 220, volume: 105, type: '–¥–≤—É—Ö—Å–æ—Ç–∫–∏', normTKVCH: 1000 },
    '7530G': { capacity: 220, volume: 105, type: '–¥–≤—É—Ö—Å–æ—Ç–∫–∏', normTKVCH: 1000 }
};
const CONDITIONS=['—Ä–µ–º–æ–Ω—Ç','—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è','—Ä–µ–∑–µ—Ä–≤','–∫–æ–Ω—Å–µ—Ä–≤–∞—Ü–∏—è'];
const SKDSH_BRANDS=['–°–ö–¢','–ï–≤–∞','–ö–æ–¥–∞','pre.pro.'];
const DEFAULT_SETTINGS={
    autoRefreshInterval:5,
    dataDepth:1,
    ktgThresholds: { excellent: 95, good: 80 },
    sensorPeriodType: 'months',
    sensorMonths: 3,
    startDate: null,
    endDate: null,
    monitoringPeriod: 72,
    tkvchThresholds: { 
        greenLower: -50, greenUpper: 50,
        yellowLower: -100, yellowUpper: 100, 
        redLower: -150, redUpper: 150 
    },
    pressureThresholds: { 
        greenLower: -0.3, greenUpper: 0.3,
        yellowLower: -0.6, yellowUpper: 0.6, 
        redLower: -1.0, redUpper: 1.0 
    },
    noPlanAnimation: 'pulse-gentle',
    noTruckGradientType: 'gradient',
    colors: {
        noTruckGradientStart: '#e9ecef',
        noTruckGradientEnd: '#dee2e6',
        noPlanColor: '#dc3545',
        excellent: '#d4edda',
        good: '#fff3cd',
        poor: '#f8d7da'
    },
    chartPeriod: 24,
    currentSystem: 'all'
};

const rndInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const rndFloat=(a,b,d=1)=>parseFloat((Math.random()*(b-a)+a).toFixed(d));
const pick=a=>a[Math.floor(Math.random()*a.length)];

/* === –ù–∞—Å—Ç—Ä–æ–π–∫–∏ === */
let settings = {...DEFAULT_SETTINGS};

/* === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ === */
let trucksData = [];
let statsData = [];
let sortState = {key:'model', dir:'asc'};
let currentFilter = null;
let activeFilters = new Map();
let statsChart = null;

/* === –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –¢–ö–í–ß –∏ –¥–∞–≤–ª–µ–Ω–∏—è === */
function getTKVCHClass(factValue, planValue) {
    if (!factValue || factValue === '-' || !planValue) return '';
    
    const deviation = factValue - planValue;
    const thresholds = settings.tkvchThresholds;
    
    if (deviation >= thresholds.greenLower && deviation <= thresholds.greenUpper) {
        return 'tkvch-excellent';
    } else if (deviation >= thresholds.yellowLower && deviation <= thresholds.yellowUpper) {
        return 'tkvch-good';
    } else {
        return 'tkvch-poor';
    }
}

function getPressureClass(factValue, planValue) {
    if (!factValue || factValue === '-' || !planValue) return '';
    
    const deviation = parseFloat(factValue) - planValue;
    const thresholds = settings.pressureThresholds;
    
    if (deviation >= thresholds.greenLower && deviation <= thresholds.greenUpper) {
        return 'pressure-excellent';
    } else if (deviation >= thresholds.yellowLower && deviation <= thresholds.yellowUpper) {
        return 'pressure-good';
    } else {
        return 'pressure-poor';
    }
}

function getKTGClass(ktgValue) {
    if (ktgValue >= settings.ktgThresholds.excellent) {
        return 'ktg-excellent';
    } else if (ktgValue >= settings.ktgThresholds.good) {
        return 'ktg-good';
    } else {
        return 'ktg-poor';
    }
}

/* === –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º === */
function applySettingsToCSS() {
    let gradientValue;
    if (settings.noTruckGradientType === 'gradient') {
        gradientValue = `linear-gradient(135deg, ${settings.colors.noTruckGradientStart}, ${settings.colors.noTruckGradientEnd})`;
    } else if (settings.noTruckGradientType === 'solid') {
        gradientValue = settings.colors.noTruckGradientStart;
    } else {
        gradientValue = `repeating-linear-gradient(45deg, ${settings.colors.noTruckGradientStart}, ${settings.colors.noTruckGradientStart} 4px, ${settings.colors.noTruckGradientEnd} 4px, ${settings.colors.noTruckGradientEnd} 8px)`;
    }
    
    document.documentElement.style.setProperty('--no-truck-gradient', gradientValue);
    document.documentElement.style.setProperty('--no-plan-color', settings.colors.noPlanColor);
    document.documentElement.style.setProperty('--excellent-color', settings.colors.excellent);
    document.documentElement.style.setProperty('--good-color', settings.colors.good);
    document.documentElement.style.setProperty('--poor-color', settings.colors.poor);
}

/* === –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç—É–ª—Ç–∏–ø–æ–≤ === */
function initAdaptiveTooltips() {
    document.addEventListener('mouseover', function(e) {
        const tooltip = e.target.closest('.tooltip');
        if (!tooltip) return;

        const tooltipText = tooltip.querySelector('.tooltip-text');
        if (!tooltipText) return;

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        tooltipText.classList.remove('top', 'left', 'right', 'bottom');
        
        // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const tooltipRect = tooltip.getBoundingClientRect();
        const tooltipTextRect = tooltipText.getBoundingClientRect();
        
        // –î–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤–æ–∫—Ä—É–≥ —ç–ª–µ–º–µ–Ω—Ç–∞
        const space = {
            top: tooltipRect.top,
            bottom: window.innerHeight - tooltipRect.bottom,
            left: tooltipRect.left,
            right: window.innerWidth - tooltipRect.right
        };
        
        let finalTop = tooltipRect.bottom + 5;
        let finalLeft = tooltipRect.left;
        let positionClass = 'bottom';
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª—É—á—à—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if (space.bottom < tooltipTextRect.height && space.top > space.bottom) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–µ—Ä—Ö—É
            finalTop = tooltipRect.top - tooltipTextRect.height - 5;
            positionClass = 'top';
        }
        
        if (space.right < tooltipTextRect.width && space.left > space.right) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–≤–∞
            finalLeft = tooltipRect.right - tooltipTextRect.width;
            positionClass += ' left';
        } else if (space.left < tooltipTextRect.width) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø—Ä–∞–≤–∞
            finalLeft = 10;
            positionClass += ' right';
        }
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–∫–Ω–∞
        finalTop = Math.max(10, Math.min(finalTop, window.innerHeight - tooltipTextRect.height - 10));
        finalLeft = Math.max(10, Math.min(finalLeft, window.innerWidth - tooltipTextRect.width - 10));
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        tooltipText.style.top = finalTop + 'px';
        tooltipText.style.left = finalLeft + 'px';
        tooltipText.classList.add(positionClass);
    });
}

/* === –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ === */
function generateTruckTooltipData(truck) {
    const conditions = ['–∏—Å–ø—Ä–∞–≤–µ–Ω', '—Ç—Ä–µ–±—É–µ—Ç –æ—Å–º–æ—Ç—Ä–∞', '–≤ —Ä–µ–º–æ–Ω—Ç–µ', '—Ä–µ–∑–µ—Ä–≤'];
    const loadPlaces = ['–ö–∞—Ä—å–µ—Ä ‚Ññ1', '–ö–∞—Ä—å–µ—Ä ‚Ññ2', '–ö–∞—Ä—å–µ—Ä ‚Ññ3', '–†–∞–∑—Ä–µ–∑ –°–µ–≤–µ—Ä–Ω—ã–π'];
    const unloadPlaces = ['–û–±–æ–≥–∞—Ç–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞', '–°–∫–ª–∞–¥', '–ü–µ—Ä–µ–≥—Ä—É–∑–æ—á–Ω—ã–π –ø—É–Ω–∫—Ç'];
    
    const noTruckConnection = Math.random() < 0.1;
    
    return {
        capacity: truck.capacity || MODELS[truck.model.replace('–ë–µ–ª–ê–ó ', '')]?.capacity || 130,
        volume: truck.volume || MODELS[truck.model.replace('–ë–µ–ª–ê–ó ', '')]?.volume || 102,
        condition: pick(conditions),
        avgSpeed: rndFloat(25, 45, 1),
        lastLoadPlace: pick(loadPlaces),
        lastUnloadPlace: pick(unloadPlaces),
        lastLoad: rndFloat(85, 100, 1),
        avgLoad: rndFloat(80, 95, 1),
        minLoad: rndFloat(70, 85, 1),
        maxLoad: rndFloat(95, 105, 1),
        lastSignal: noTruckConnection ? 
            new Date(Date.now() - rndInt(2, 10) * 86400000).toLocaleString('ru-RU') : 
            new Date(Date.now() - rndInt(5, 120) * 60000).toLocaleString('ru-RU'),
        noTruckConnection: noTruckConnection
    };
}

function generateTKVCHTooltipData(tkvchValue, axleType, model) {
    const tireBrands = ['MICHELIN', 'BRIDGESTONE', 'GOODYEAR', 'CONTINENTAL'];
    const tireModels = ['XDR2', 'XDR3', 'VSDL', 'G177'];
    const compounds = ['ROCK', 'QUARRY', 'HD', 'EXTREME'];
    
    const noPlan = Math.random() < 0.2;
    const planValue = MODELS[model.replace('–ë–µ–ª–ê–ó ', '')]?.normTKVCH || 700;
    
    return {
        plan: noPlan ? null : planValue,
        fact: tkvchValue,
        deviation: tkvchValue - planValue,
        exceedDuration: rndInt(5, 120) + ' –º–∏–Ω',
        violationTime: new Date(Date.now() - rndInt(1, 24) * 3600000).toLocaleString('ru-RU'),
        tripDistance: rndInt(3, 15) + ' –∫–º',
        speed: rndInt(30, 55) + ' –∫–º/—á',
        load: rndInt(100, 220) + ' —Ç',
        slope: rndInt(2, 8) + '%',
        violationCount: rndInt(0, 10),
        avgDuration: rndInt(10, 60) + ' –º–∏–Ω',
        avg24h: tkvchValue + rndInt(-20, 20),
        tireBrand: pick(tireBrands),
        tireModel: pick(tireModels),
        tireCompound: pick(compounds),
        noPlan: noPlan
    };
}

function generatePressureTooltipData(pressureValue, position) {
    const tireBrands = ['MICHELIN', 'BRIDGESTONE', 'GOODYEAR', 'CONTINENTAL'];
    const tireModels = ['XDR2', 'XDR3', 'VSDL', 'G177'];
    const compounds = ['ROCK', 'QUARRY', 'HD', 'EXTREME'];
    
    const noPlan = Math.random() < 0.2;
    const noSensorConnection = Math.random() < 0.15;
    const planValue = 7.3;
    
    const lastReadingTime = noSensorConnection ? 
        new Date(Date.now() - rndInt(1, 24) * 3600000) : 
        new Date(Date.now() - rndInt(1, 10) * 60000);
    
    const lastReadingValue = noSensorConnection ? 
        rndFloat(6.5, 7.5, 1) : pressureValue;
    
    return {
        plan: noPlan ? null : planValue,
        fact: pressureValue,
        deviation: parseFloat(pressureValue) - planValue,
        temperaturePlan: noPlan ? null : 80,
        temperatureFact: rndInt(70, 90),
        exceedDuration: pressureValue < 7.0 ? rndInt(10, 120) + ' –º–∏–Ω' : '0',
        violationTime: pressureValue < 7.0 ? new Date(Date.now() - rndInt(10, 180) * 60000).toLocaleString('ru-RU') : '-',
        lastPressure: lastReadingValue,
        lastPressureTime: lastReadingTime.toLocaleString('ru-RU'),
        tireBrand: pick(tireBrands),
        tireModel: pick(tireModels),
        tireCompound: pick(compounds),
        tireNumber: 'V' + rndInt(80000, 99999),
        tireMileage: rndInt(5000, 50000) + ' –∫–º',
        skdsh: pick(SKDSH_BRANDS),
        noPlan: noPlan,
        noSensorConnection: noSensorConnection
    };
}

function generateStatsTooltipData(skdsh, column) {
    const data = {
        total: {
            title: `–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ${skdsh}`,
            systems: rndInt(50, 200),
            ktg: rndInt(80, 100),
            workingSensors: rndInt(45, 190),
            failedSensors: rndInt(1, 15),
            avgUptime: rndInt(85, 99) + '%'
        },
        skt: {
            title: `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –°–ö–¢ –¥–ª—è ${skdsh}`,
            systems: rndInt(20, 80),
            ktg: rndInt(75, 98),
            features: ['–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∞–≤–ª–µ–Ω–∏—è', '–ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã', '–ê–Ω–∞–ª–∏–∑ –∏–∑–Ω–æ—Å–∞'],
            reliability: rndInt(85, 95) + '%'
        },
        eva: {
            title: `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ EVA –¥–ª—è ${skdsh}`,
            systems: rndInt(15, 60),
            ktg: rndInt(70, 95),
            features: ['–£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑', '–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ', '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã'],
            reliability: rndInt(80, 90) + '%'
        },
        prepro: {
            title: `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Pre.pro. –¥–ª—è ${skdsh}`,
            systems: rndInt(10, 40),
            ktg: rndInt(65, 90),
            features: ['–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞', '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ERP', '–ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ—Ç—á–µ—Ç—ã'],
            reliability: rndInt(75, 85) + '%'
        }
    };
    
    return data[column] || data.total;
}

/* === –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è HTML –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ === */
function createTruckTooltipHTML(tooltipData) {
    let connectionInfo = '';
    if (tooltipData.noTruckConnection) {
        connectionInfo = `<br><strong style="color:#dc3545">–û–¢–°–£–¢–°–¢–í–£–ï–¢ –°–í–Ø–ó–¨ –° –ê/–°</strong><br>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª: ${tooltipData.lastSignal}`;
    }
    
    return `
        <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Å–∞–º–æ—Å–≤–∞–ª—É</strong><br>
        –ì—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç—å: ${tooltipData.capacity} —Ç–Ω<br>
        –û–±—ä–µ–º –∫—É–∑–æ–≤–∞: ${tooltipData.volume} –º¬≥<br>
        –°–æ—Å—Ç–æ—è–Ω–∏–µ: ${tooltipData.condition}<br>
        –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å (24—á): ${tooltipData.avgSpeed} –∫–º/—á<br>
        –ú–µ—Å—Ç–æ –ø–æ–≥—Ä—É–∑–∫–∏: ${tooltipData.lastLoadPlace}<br>
        –ú–µ—Å—Ç–æ —Ä–∞–∑–≥—Ä—É–∑–∫–∏: ${tooltipData.lastUnloadPlace}<br>
        –ó–∞–≥—Ä—É–∑–∫–∞: ${tooltipData.lastLoad}% (–∫—Ä–∞–π–Ω–∏–π)/${tooltipData.avgLoad}% (—Å—Ä–µ–¥. 24—á)<br>
        –ú–∏–Ω/–º–∞–∫—Å –∑–∞–≥—Ä—É–∑–∫–∞ (24—á): ${tooltipData.minLoad}%/${tooltipData.maxLoad}%<br>
        –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª: ${tooltipData.lastSignal}
        ${connectionInfo}
    `;
}

function createTKVCHTooltipHTML(tooltipData, axleType) {
    let planInfo = '';
    if (tooltipData.noPlan) {
        planInfo = `<br><strong style="color:#dc3545">–ü–õ–ê–ù–û–í–´–ô –ü–û–ö–ê–ó–ê–¢–ï–õ–¨ –ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù</strong>`;
    }
    
    const deviationInfo = tooltipData.plan ? 
        `<br>–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: ${tooltipData.deviation > 0 ? '+' : ''}${tooltipData.deviation.toFixed(1)}¬∞C` : 
        '';
    
    return `
        <strong>–¢–ö–í–ß ${axleType} –æ—Å—å</strong><br>
        –ü–ª–∞–Ω/—Ñ–∞–∫—Ç: ${tooltipData.plan ? tooltipData.plan + '¬∞C/' + tooltipData.fact + '¬∞C' : '–ù–ï–¢ –ü–õ–ê–ù–ê/' + tooltipData.fact + '¬∞C'}${planInfo}${deviationInfo}<br>
        –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è: ${tooltipData.exceedDuration}<br>
        –î–∞—Ç–∞/–≤—Ä–µ–º—è –Ω–∞—Ä—É—à–µ–Ω–∏—è: ${tooltipData.violationTime}<br>
        –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–π—Å–∞: ${tooltipData.tripDistance}<br>
        –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–π—Å–∞: ${tooltipData.speed}<br>
        –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–∞: ${tooltipData.load}<br>
        –£–∫–ª–æ–Ω: ${tooltipData.slope}<br>
        –†–µ–π—Å–æ–≤ —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º: ${tooltipData.violationCount}<br>
        –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${tooltipData.avgDuration}<br>
        –°—Ä–µ–¥–Ω–µ–µ –∑–∞ 24—á: ${tooltipData.avg24h}¬∞C<br>
        –®–∏–Ω–∞: ${tooltipData.tireBrand} ${tooltipData.tireModel}<br>
        –ö–æ–º–ø–∞—É–Ω–¥: ${tooltipData.tireCompound}
    `;
}

function createPressureTooltipHTML(tooltipData, position) {
    let planInfo = '';
    let sensorInfo = '';
    
    if (tooltipData.noPlan) {
        planInfo = `<br><strong style="color:#dc3545">–ü–õ–ê–ù–û–í–´–ô –ü–û–ö–ê–ó–ê–¢–ï–õ–¨ –ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù</strong>`;
    }
    
    if (tooltipData.noSensorConnection) {
        sensorInfo = `
            <br><strong style="color:#6c757d">–û–¢–°–£–¢–°–¢–í–£–ï–¢ –°–í–Ø–ó–¨ –° –î–ê–¢–ß–ò–ö–û–ú –î–ê–í–õ–ï–ù–ò–Ø</strong><br>
            –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: ${tooltipData.lastPressure} –±–∞—Ä<br>
            –í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è: ${tooltipData.lastPressureTime}
        `;
    }
    
    const deviationInfo = tooltipData.plan ? 
        `<br>–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: ${tooltipData.deviation > 0 ? '+' : ''}${tooltipData.deviation.toFixed(1)} –±–∞—Ä` : 
        '';
    
    return `
        <strong>–î–∞–≤–ª–µ–Ω–∏–µ ${position}</strong><br>
        –î–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω/—Ñ–∞–∫—Ç: ${tooltipData.plan ? tooltipData.plan + ' –±–∞—Ä/' + tooltipData.fact + ' –±–∞—Ä' : '–ù–ï–¢ –ü–õ–ê–ù–ê/' + tooltipData.fact + ' –±–∞—Ä'}${planInfo}${deviationInfo}<br>
        –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–ª–∞–Ω/—Ñ–∞–∫—Ç: ${tooltipData.temperaturePlan ? tooltipData.temperaturePlan + '¬∞C/' + tooltipData.temperatureFact + '¬∞C' : '–ù–ï–¢ –ü–õ–ê–ù–ê/' + tooltipData.temperatureFact + '¬∞C'}<br>
        –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è: ${tooltipData.exceedDuration}<br>
        –ù–∞—á–∞–ª–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è: ${tooltipData.violationTime}<br>
        –ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ: ${tooltipData.lastPressure} –±–∞—Ä<br>
        –í—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏: ${tooltipData.lastPressureTime}<br>
        –®–∏–Ω–∞: ${tooltipData.tireBrand} ${tooltipData.tireModel}<br>
        –ö–æ–º–ø–∞—É–Ω–¥: ${tooltipData.tireCompound}<br>
        –ù–æ–º–µ—Ä —à–∏–Ω—ã: ${tooltipData.tireNumber}<br>
        –ü—Ä–æ–±–µ–≥ —à–∏–Ω—ã: ${tooltipData.tireMileage}<br>
        –°–ö–î–®: ${tooltipData.skdsh}
        ${sensorInfo}
    `;
}

function createStatsColumnTooltipHTML(tooltipData) {
    return `
        <strong>${tooltipData.title}</strong><br>
        –°–∏—Å—Ç–µ–º: ${tooltipData.systems}<br>
        –ö–¢–ì: ${tooltipData.ktg}%<br>
        –†–∞–±–æ—á–∏—Ö –¥–∞—Ç—á–∏–∫–æ–≤: ${tooltipData.workingSensors || 'N/A'}<br>
        –ù–µ–∏—Å–ø—Ä–∞–≤–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤: ${tooltipData.failedSensors || 'N/A'}<br>
        –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: ${tooltipData.reliability || 'N/A'}<br>
        ${tooltipData.features ? `–§—É–Ω–∫—Ü–∏–∏: ${tooltipData.features.join(', ')}` : ''}
    `;
}

/* === –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö === */
function generateTKVCH(type){
    return (type==='—Å–æ—Ç–∫–∏')
      ? {front:rndInt(500,745), rear:rndInt(500,745)}
      : {front:rndInt(900,1200), rear:rndInt(900,1200)};
}

function generateTruckList(){
    const trucks=[]; 
    const dist={'75131':8,'7513D':8,'75306':7,'7530G':7};
    
    Object.keys(MODELS).forEach(m=>{
        const cnt=dist[m]; 
        const meta=MODELS[m];
        for(let i=0;i<cnt;i++){
            const tkv=generateTKVCH(meta.type);
            const pressures=Array.from({length:6},()=>rndFloat(6.7,9.0).toFixed(1));
            
            const truck = {
                id:1000+trucks.length+1,
                model:`–ë–µ–ª–ê–ó ${m}`,
                number:`–ê–ö-${1100+trucks.length+1}`,
                skdsh:pick(SKDSH_BRANDS),
                tkvchFront:tkv.front,
                tkvchRear:tkv.rear,
                pressures: pressures,
                capacity: meta.capacity,
                volume: meta.volume,
                ktg: rndInt(70, 100) // –î–æ–±–∞–≤–ª—è–µ–º –ö–¢–ì –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∞–º–æ—Å–≤–∞–ª–∞
            };
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
            truck.truckTooltipData = generateTruckTooltipData(truck);
            truck.tkvchFrontTooltipData = generateTKVCHTooltipData(tkv.front, '–ø–µ—Ä–µ–¥–Ω—è—è', truck.model);
            truck.tkvchRearTooltipData = generateTKVCHTooltipData(tkv.rear, '–∑–∞–¥–Ω—è—è', truck.model);
            truck.pressureTooltipData = pressures.map((p, index) => 
                generatePressureTooltipData(parseFloat(p), POS_LABELS[index])
            );
            
            trucks.push(truck);
        }
    });
    return trucks;
}

/* === –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ò === */
function generateStatsData() {
    const stats = [];
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–∞–º–æ—Å–≤–∞–ª—ã –ø–æ –º–æ–¥–µ–ª—è–º
    const modelGroups = {};
    
    trucksData.forEach(truck => {
        if (!modelGroups[truck.model]) {
            modelGroups[truck.model] = [];
        }
        modelGroups[truck.model].push(truck);
    });
    
    // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
    Object.keys(modelGroups).forEach(model => {
        const trucks = modelGroups[model];
        const stat = {
            model: model,
            truckCount: trucks.length,
            total: { systems: trucks.length, ktg: 0 },
            skt: { systems: 0, ktg: 0 },
            eva: { systems: 0, ktg: 0 },
            koda: { systems: 0, ktg: 0 },
            prepro: { systems: 0, ktg: 0 }
        };
        
        // –°—á–∏—Ç–∞–µ–º –ø–æ —Å–∏—Å—Ç–µ–º–∞–º –°–ö–î–®
        const systemKtg = {
            '–°–ö–¢': { total: 0, count: 0 },
            '–ï–≤–∞': { total: 0, count: 0 },
            '–ö–æ–¥–∞': { total: 0, count: 0 },
            'pre.pro.': { total: 0, count: 0 }
        };
        
        let totalKtg = 0;
        
        trucks.forEach(truck => {
            totalKtg += truck.ktg;
            if (systemKtg[truck.skdsh]) {
                systemKtg[truck.skdsh].total += truck.ktg;
                systemKtg[truck.skdsh].count += 1;
            }
        });
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        stat.total.ktg = Math.round(totalKtg / trucks.length);
        stat.skt.systems = systemKtg['–°–ö–¢'].count;
        stat.skt.ktg = systemKtg['–°–ö–¢'].count > 0 ? Math.round(systemKtg['–°–ö–¢'].total / systemKtg['–°–ö–¢'].count) : 0;
        stat.eva.systems = systemKtg['–ï–≤–∞'].count;
        stat.eva.ktg = systemKtg['–ï–≤–∞'].count > 0 ? Math.round(systemKtg['–ï–≤–∞'].total / systemKtg['–ï–≤–∞'].count) : 0;
        stat.koda.systems = systemKtg['–ö–æ–¥–∞'].count;
        stat.koda.ktg = systemKtg['–ö–æ–¥–∞'].count > 0 ? Math.round(systemKtg['–ö–æ–¥–∞'].total / systemKtg['–ö–æ–¥–∞'].count) : 0;
        stat.prepro.systems = systemKtg['pre.pro.'].count;
        stat.prepro.ktg = systemKtg['pre.pro.'].count > 0 ? Math.round(systemKtg['pre.pro.'].total / systemKtg['pre.pro.'].count) : 0;
        
        stats.push(stat);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É "–í—Å–µ–≥–æ"
    const totalStat = {
        model: '–í—Å–µ–≥–æ',
        truckCount: trucksData.length,
        total: { systems: trucksData.length, ktg: 0 },
        skt: { systems: 0, ktg: 0 },
        eva: { systems: 0, ktg: 0 },
        koda: { systems: 0, ktg: 0 },
        prepro: { systems: 0, ktg: 0 }
    };
    
    const totalSystemKtg = {
        '–°–ö–¢': { total: 0, count: 0 },
        '–ï–≤–∞': { total: 0, count: 0 },
        '–ö–æ–¥–∞': { total: 0, count: 0 },
        'pre.pro.': { total: 0, count: 0 }
    };
    
    let grandTotalKtg = 0;
    
    trucksData.forEach(truck => {
        grandTotalKtg += truck.ktg;
        if (totalSystemKtg[truck.skdsh]) {
            totalSystemKtg[truck.skdsh].total += truck.ktg;
            totalSystemKtg[truck.skdsh].count += 1;
        }
    });
    
    totalStat.total.ktg = Math.round(grandTotalKtg / trucksData.length);
    totalStat.skt.systems = totalSystemKtg['–°–ö–¢'].count;
    totalStat.skt.ktg = totalSystemKtg['–°–ö–¢'].count > 0 ? Math.round(totalSystemKtg['–°–ö–¢'].total / totalSystemKtg['–°–ö–¢'].count) : 0;
    totalStat.eva.systems = totalSystemKtg['–ï–≤–∞'].count;
    totalStat.eva.ktg = totalSystemKtg['–ï–≤–∞'].count > 0 ? Math.round(totalSystemKtg['–ï–≤–∞'].total / totalSystemKtg['–ï–≤–∞'].count) : 0;
    totalStat.koda.systems = totalSystemKtg['–ö–æ–¥–∞'].count;
    totalStat.koda.ktg = totalSystemKtg['–ö–æ–¥–∞'].count > 0 ? Math.round(totalSystemKtg['–ö–æ–¥–∞'].total / totalSystemKtg['–ö–æ–¥–∞'].count) : 0;
    totalStat.prepro.systems = totalSystemKtg['pre.pro.'].count;
    totalStat.prepro.ktg = totalSystemKtg['pre.pro.'].count > 0 ? Math.round(totalSystemKtg['pre.pro.'].total / totalSystemKtg['pre.pro.'].count) : 0;
    
    stats.unshift(totalStat);
    
    return stats;
}

/* === –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ === */
function applyFilters(trucks) {
    if (activeFilters.size === 0 && !currentFilter) return trucks;
    
    let filtered = trucks;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –º–æ–¥–µ–ª–∏ –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    if (currentFilter && currentFilter.type === 'model') {
        filtered = filtered.filter(truck => truck.model === currentFilter.value);
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
    if (activeFilters.size > 0) {
        filtered = filtered.filter(truck => {
            let includeTruck = true;
            
            activeFilters.forEach((mode, filterType) => {
                let matchesFilter = false;
                
                switch(filterType) {
                    case 'exceedTKVCH':
                        const frontPlan = MODELS[truck.model.replace('–ë–µ–ª–ê–ó ', '')]?.normTKVCH || 700;
                        const rearPlan = frontPlan;
                        const frontDeviation = truck.tkvchFront - frontPlan;
                        const rearDeviation = truck.tkvchRear - rearPlan;
                        const frontExceed = Math.abs(frontDeviation) > settings.tkvchThresholds.redUpper;
                        const rearExceed = Math.abs(rearDeviation) > settings.tkvchThresholds.redUpper;
                        matchesFilter = frontExceed || rearExceed;
                        break;
                        
                    case 'exceedPressure':
                        const pressurePlan = 7.3;
                        const pressureExceed = truck.pressures.some(p => {
                            const deviation = Math.abs(parseFloat(p) - pressurePlan);
                            return deviation > settings.pressureThresholds.redUpper;
                        });
                        matchesFilter = pressureExceed;
                        break;
                        
                    case 'noPlan':
                        const hasNoPlan = truck.tkvchFrontTooltipData.noPlan || 
                                         truck.tkvchRearTooltipData.noPlan || 
                                         truck.pressureTooltipData.some(p => p.noPlan);
                        matchesFilter = hasNoPlan;
                        break;
                        
                    case 'noTruckConnection':
                        matchesFilter = truck.truckTooltipData.noTruckConnection;
                        break;
                        
                    case 'noSensorConnection':
                        const hasNoSensorConnection = truck.pressureTooltipData.some(p => p.noSensorConnection);
                        matchesFilter = hasNoSensorConnection;
                        break;
                }
                
                if (mode === 'include') {
                    includeTruck = includeTruck && matchesFilter;
                } else if (mode === 'exclude') {
                    includeTruck = includeTruck && !matchesFilter;
                }
            });
            
            return includeTruck;
        });
    }
    
    return filtered;
}

/* === –†–µ–Ω–¥–µ—Ä —Ç–∞–±–ª–∏—Ü—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ === */
function renderTrucksTable(){
    const tbody = document.getElementById('trucksTableBody');
    if (!tbody) {
        console.error('Element trucksTableBody not found');
        return;
    }
    
    tbody.innerHTML = '';

    let data = [...trucksData];
    data = applyFilters(data);

    if (currentFilter){
        data = data.filter(t => {
            if (currentFilter.type === 'skdsh') return t.skdsh.includes(currentFilter.value);
            return true;
        });
    }

    data.sort((a,b) => {
        let av = a[sortState.key], bv = b[sortState.key];
        if (sortState.key === 'pressures'){ 
            av = parseFloat(a.pressures?.[0] || 0); 
            bv = parseFloat(b.pressures?.[0] || 0); 
        }
        if (av < bv) return sortState.dir === 'asc' ? -1 : 1;
        if (av > bv) return sortState.dir === 'asc' ? 1 : -1;
        return 0;
    });

    data.forEach(truck => {
        const tr = document.createElement('tr');

        // –ü–†–ò–û–†–ò–¢–ï–¢ 1: –Ω–µ—Ç —Å–≤—è–∑–∏ —Å —Å–∞–º–æ—Å–≤–∞–ª–æ–º ‚Äî –∫—Ä–∞—Å–∏–º —Å—Ç—Ä–æ–∫—É
        const rowNoTruck = !!truck.truckTooltipData.noTruckConnection;
        if (rowNoTruck) tr.classList.add('row-no-truck');

        // –ü–æ–ª—É—á–∞–µ–º –ø–ª–∞–Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –¢–ö–í–ß
        const tkvchPlan = MODELS[truck.model.replace('–ë–µ–ª–ê–ó ', '')]?.normTKVCH || 700;
        
        // –õ–æ–≥–∏–∫–∞ –æ–∫—Ä–∞—Å–∫–∏ –¢–ö–í–ß - –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –ø–ª–∞–Ω–∞
        const tkvchFrontClass = !rowNoTruck && !truck.tkvchFrontTooltipData.noPlan ? 
            getTKVCHClass(truck.tkvchFront, tkvchPlan) : '';
        const tkvchRearClass = !rowNoTruck && !truck.tkvchRearTooltipData.noPlan ? 
            getTKVCHClass(truck.tkvchRear, tkvchPlan) : '';

        // –§–ª–∞–≥–∏ ¬´–Ω–µ—Ç –ø–ª–∞–Ω–∞¬ª
        const noPlanFront = truck.tkvchFrontTooltipData.noPlan;
        const noPlanRear  = truck.tkvchRearTooltipData.noPlan;

        tr.innerHTML = `
            <td class="model-column">${truck.model}</td>
            <td class="number-column">
                <div class="tooltip">
                    ${truck.number}
                    <span class="tooltip-text">${createTruckTooltipHTML(truck.truckTooltipData)}</span>
                </div>
            </td>
            <td class="skdsh-column">${truck.skdsh}</td>

            <td class="tkvch-column ${noPlanFront ? 'cell-no-plan' : (rowNoTruck ? '' : tkvchFrontClass)}">
                <div class="tooltip">
                    <span class="${noPlanFront ? 'no-plan-text' : ''}">${truck.tkvchFront}</span>
                    <span class="tooltip-text">${createTKVCHTooltipHTML(truck.tkvchFrontTooltipData, '–ø–µ—Ä–µ–¥–Ω—è—è')}</span>
                </div>
            </td>
            <td class="tkvch-column ${noPlanRear ? 'cell-no-plan' : (rowNoTruck ? '' : tkvchRearClass)}">
                <div class="tooltip">
                    <span class="${noPlanRear ? 'no-plan-text' : ''}">${truck.tkvchRear}</span>
                    <span class="tooltip-text">${createTKVCHTooltipHTML(truck.tkvchRearTooltipData, '–∑–∞–¥–Ω—è—è')}</span>
                </div>
            </td>
        `;

        // –î–∞–≤–ª–µ–Ω–∏–µ ‚Äî 6 —è—á–µ–µ–∫ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
        const pressurePlan = 7.3;
        truck.pressures.forEach((p,i) => {
            const info = truck.pressureTooltipData[i];
            let tdClass = '';
            let textClass = '';

            if (rowNoTruck) {
                // –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 —É–∂–µ –ø–æ–∫—Ä–∞—Å–∏–ª —Å—Ç—Ä–æ–∫—É ‚Äî —è—á–µ–π–∫–∞ –±–µ–∑ –¥–æ–ø.—Ü–≤–µ—Ç–æ–≤
                tdClass = '';
            } else if (info.noSensorConnection) {
                // –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3
                tdClass = 'cell-no-sensor';
            } else if (info.noPlan) {
                // –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–º–∫–∞ + –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–π —Ç–µ–∫—Å—Ç)
                tdClass = 'cell-no-plan';
                textClass = 'no-plan-text';
            } else {
                // –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4 ‚Äî –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –ø–ª–∞–Ω–∞
                tdClass = getPressureClass(parseFloat(p), pressurePlan);
            }

            const td = document.createElement('td');
            td.className = `pressure-cell ${tdClass}`;
            td.innerHTML = `
                <div class="tooltip">
                    <span class="${textClass}">${p}</span>
                    <span class="tooltip-text">${createPressureTooltipHTML(info, POS_LABELS[i])}</span>
                </div>
            `;
            tr.appendChild(td);
        });

        tbody.appendChild(tr);
    });

    updateSortIndicators('trucksTable');
}

/* === –†–µ–Ω–¥–µ—Ä —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ === */
function renderStatsTable(){
    const tbody = document.getElementById('statsTableBody');
    if (!tbody) {
        console.error('Element statsTableBody not found');
        return;
    }
    
    tbody.innerHTML = '';
    
    let sortedStats = [...statsData];
    sortedStats.sort((a, b) => {
        let av, bv;
        
        switch(sortState.key) {
            case 'model':
                av = a.model;
                bv = b.model;
                // "–í—Å–µ–≥–æ" –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤—ã–π
                if (av === '–í—Å–µ–≥–æ') return -1;
                if (bv === '–í—Å–µ–≥–æ') return 1;
                break;
            case 'truckCount':
                av = a.truckCount;
                bv = b.truckCount;
                break;
            case 'total':
                av = a.total.ktg;
                bv = b.total.ktg;
                break;
            case 'skt':
                av = a.skt.ktg;
                bv = b.skt.ktg;
                break;
            case 'eva':
                av = a.eva.ktg;
                bv = b.eva.ktg;
                break;
            case 'koda':
                av = a.koda.ktg;
                bv = b.koda.ktg;
                break;
            case 'prepro':
                av = a.prepro.ktg;
                bv = b.prepro.ktg;
                break;
            default:
                av = a.model;
                bv = b.model;
        }
        
        if (av < bv) return sortState.dir === 'asc' ? -1 : 1;
        if (av > bv) return sortState.dir === 'asc' ? 1 : -1;
        return 0;
    });

    sortedStats.forEach(stat => {
        const tr = document.createElement('tr');
        tr.setAttribute('data-model', stat.model);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç—Ä–æ–∫–∏ "–í—Å–µ–≥–æ"
        if (stat.model === '–í—Å–µ–≥–æ') {
            tr.classList.add('total-row');
        }
        
        tr.innerHTML = `
            <td class="clickable model-cell">${stat.model}</td>
            <td class="clickable">${stat.truckCount}</td>
            <td class="clickable ${getKTGClass(stat.total.ktg)}">
                ${stat.total.systems}/${stat.total.ktg}%
            </td>
            <td class="clickable ${getKTGClass(stat.skt.ktg)}">
                ${stat.skt.systems}/${stat.skt.ktg}%
            </td>
            <td class="clickable ${getKTGClass(stat.eva.ktg)}">
                ${stat.eva.systems}/${stat.eva.ktg}%
            </td>
            <td class="clickable ${getKTGClass(stat.koda.ktg)}">
                ${stat.koda.systems}/${stat.koda.ktg}%
            </td>
            <td class="clickable ${getKTGClass(stat.prepro.ktg)}">
                ${stat.prepro.systems}/${stat.prepro.ktg}%
            </td>
        `;
        tbody.appendChild(tr);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    document.querySelectorAll('#statsTable .model-cell').forEach(cell => {
        cell.addEventListener('click', function() {
            const row = this.closest('tr');
            const model = row.getAttribute('data-model');
            
            if (model === '–í—Å–µ–≥–æ') {
                // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–∞
                currentFilter = null;
                document.querySelectorAll('#statsTable tr').forEach(r => r.classList.remove('selected'));
                row.classList.add('selected');
            } else {
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–æ–¥–µ–ª–∏
                currentFilter = { type: 'model', value: model };
                document.querySelectorAll('#statsTable tr').forEach(r => r.classList.remove('selected'));
                row.classList.add('selected');
            }
            
            renderTrucksTable();
        });
    });
    
    updateSortIndicators('statsTable');
}

/* === –ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ === */
function initChartControls() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–∏—Å—Ç–µ–º
    const systemButtons = document.querySelectorAll('.chart-control-btn[data-system]');
    systemButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            systemButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            settings.currentSystem = this.getAttribute('data-system');
            renderStatsChart();
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
    document.getElementById('chartPeriod').addEventListener('change', function() {
        settings.chartPeriod = parseInt(this.value);
        renderStatsChart();
    });
}


function renderStatsChart() {
    const ctx = document.getElementById('statsChart');
    if (!ctx) return;
    
    if (statsChart) {
        statsChart.destroy();
    }
    
    const months = settings.chartPeriod;
    const system = settings.currentSystem;
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
    const chartData = generateChartData(months, system);
    
    statsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartData.labels,
            datasets: [
                {
                    label: '–ü–ª–∞–Ω',
                    data: chartData.sensorPlan,
                    backgroundColor: system === 'total' ? 'rgba(54, 162, 235, 0.7)' : 'transparent',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: system === 'total' ? 1 : 2,
                    borderDash: system === 'total' ? [] : [5, 5],
                    yAxisID: 'y'
                },
                {
                    label: '–§–∞–∫—Ç',
                    data: chartData.sensorFact,
                    backgroundColor: system === 'total' ? 'rgba(75, 192, 192, 0.7)' : 'transparent',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: system === 'total' ? 1 : 2,
                    yAxisID: 'y'
                },
                {
                    label: '–ö–¢–ì',
                    data: chartData.ktg,
                    type: 'line',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderWidth: 2,
                    fill: false,
                    yAxisID: 'y1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: system === 'total' ? '–°–∏—Å—Ç–µ–º—ã –°–ö–î–®' : '–ú–µ—Å—è—Ü—ã'
                    }
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: system === 'total' ? '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞—Ç—á–∏–∫–æ–≤' : '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'
                    },
                    beginAtZero: true,
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: '–ö–¢–ì (%)'
                    },
                    min: 0,
                    max: 100,
                    grid: {
                        drawOnChartArea: false,
                    },
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: chartData.title
                }
            }
        }
    });
}


function generateChartData(months, system) {
    const labels = [];
    const sensorPlan = [];
    const sensorFact = [];
    const ktg = [];
    
    if (system === 'total') {
        // –†–µ–∂–∏–º "–í—Å–µ–≥–æ" - —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º —Å–∏—Å—Ç–µ–º–∞–º –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        const totalStat = statsData.find(stat => stat.model === '–í—Å–µ–≥–æ');
        
        if (totalStat) {
            // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º –°–ö–î–®
            labels.push('–°–ö–¢', 'EVA', '–ö–æ–¥–∞', 'Pre.pro.', '–í—Å–µ–≥–æ');
            sensorPlan.push(
                totalStat.skt.systems,
                totalStat.eva.systems, 
                totalStat.koda.systems,
                totalStat.prepro.systems,
                totalStat.total.systems
            );
            sensorFact.push(
                totalStat.skt.ktg,
                totalStat.eva.ktg,
                totalStat.koda.ktg, 
                totalStat.prepro.ktg,
                totalStat.total.ktg
            );
            ktg.push(
                totalStat.skt.ktg,
                totalStat.eva.ktg,
                totalStat.koda.ktg,
                totalStat.prepro.ktg,
                totalStat.total.ktg
            );
        }
    } else {
        // –†–µ–∂–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã - —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞ –ø–æ –º–µ—Å—è—Ü–∞–º
        const today = new Date();
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∏ –º–µ—Å—è—Ü–µ–≤
        for (let i = months - 1; i >= 0; i--) {
            const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
            labels.push(date.toLocaleDateString('ru-RU', { month: 'short', year: 'numeric' }));
        }
        
        // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã
        let basePlan, baseFact, baseKtg;
        
        switch(system) {
            case 'skt':
                basePlan = 85;
                baseFact = 82;
                baseKtg = 80;
                break;
            case 'eva':
                basePlan = 75;
                baseFact = 72;
                baseKtg = 70;
                break;
            case 'koda':
                basePlan = 65;
                baseFact = 62;
                baseKtg = 60;
                break;
            case 'prepro':
                basePlan = 55;
                baseFact = 52;
                baseKtg = 50;
                break;
            default:
                basePlan = 70;
                baseFact = 67;
                baseKtg = 65;
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Ç—Ä–µ–Ω–¥–æ–º –∏ —Å–µ–∑–æ–Ω–Ω—ã–º–∏ –∫–æ–ª–µ–±–∞–Ω–∏—è–º–∏
        for (let i = 0; i < months; i++) {
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–π —Ç—Ä–µ–Ω–¥ —Ä–æ—Å—Ç–∞
            const trend = i * 0.5;
            // –°–µ–∑–æ–Ω–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è (—Å–∏–Ω—É—Å–æ–∏–¥–∞ —Å –ø–µ—Ä–∏–æ–¥–æ–º 12 –º–µ—Å—è—Ü–µ–≤)
            const seasonal = Math.sin(i * 2 * Math.PI / 12) * 3;
            // –°–ª—É—á–∞–π–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è
            const random = rndInt(-2, 2);
            
            sensorPlan.push(Math.max(0, basePlan + trend + seasonal + random));
            sensorFact.push(Math.max(0, baseFact + trend + seasonal + random - 3)); // –§–∞–∫—Ç –æ–±—ã—á–Ω–æ –Ω–∏–∂–µ –ø–ª–∞–Ω–∞
            ktg.push(Math.max(0, Math.min(100, baseKtg + trend + seasonal + random)));
        }
    }
    
    return {
        labels,
        sensorPlan,
        sensorFact,
        ktg,
        title: system === 'total' 
            ? '–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ –≤—Å–µ–º —Å–∏—Å—Ç–µ–º–∞–º –°–ö–î–®' 
            : `–†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞ —Å–∏—Å—Ç–µ–º—ã ${system.toUpperCase()} –∑–∞ ${months} –º–µ—Å—è—Ü–µ–≤`
    };
}


/* === –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ === */
function initSorting(){
    document.querySelectorAll('.monitoring-table th.sortable').forEach(th => {
        th.addEventListener('click', function(){
            const key = this.getAttribute('data-key');
            const tableId = this.closest('table').id;
            if (sortState.key === key) {
                sortState.dir = (sortState.dir === 'asc') ? 'desc' : 'asc';
            } else { 
                sortState.key = key; 
                sortState.dir = 'asc'; 
            }
            
            if (tableId === 'trucksTable') renderTrucksTable();
            else if (tableId === 'statsTable') renderStatsTable();
        });
    });
}

function updateSortIndicators(tableId){
    document.querySelectorAll(`#${tableId} th.sortable`).forEach(th => {
        const key = th.getAttribute('data-key');
        th.classList.remove('asc','desc');
        if (key === sortState.key) th.classList.add(sortState.dir);
    });
}

/* === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ === */
function initFilters() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const filterType = this.getAttribute('data-filter');
            
            if (filterType === 'clear') {
                activeFilters.clear();
                filterButtons.forEach(b => {
                    b.classList.remove('active', 'exclude');
                });
                currentFilter = null;
                document.querySelectorAll('#statsTable tr').forEach(r => r.classList.remove('selected'));
            } else {
                if (!activeFilters.has(filterType)) {
                    activeFilters.set(filterType, 'include');
                    this.classList.add('active');
                    this.classList.remove('exclude');
                } else if (activeFilters.get(filterType) === 'include') {
                    activeFilters.set(filterType, 'exclude');
                    this.classList.remove('active');
                    this.classList.add('exclude');
                } else {
                    activeFilters.delete(filterType);
                    this.classList.remove('active', 'exclude');
                }
            }
            
            renderTrucksTable();
        });
    });
}

/* === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω—é === */
function initMenu(){
    const btn = document.getElementById('menuButton');
    const dd = document.getElementById('menuDropdown');
    if (btn && dd) {
        btn.addEventListener('click', e => {
            e.stopPropagation(); 
            dd.classList.toggle('show');
        });
        document.addEventListener('click', e => {
            if (!btn.contains(e.target) && !dd.contains(e.target)) {
                dd.classList.remove('show');
            }
        });
    }
}

/* === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ === */
function initSettingsModal() {
    const modal = document.getElementById('settingsModal');
    const settingsBtn = document.getElementById('settingsBtn');
    const closeBtn = document.getElementById('closeSettingsModal');
    const cancelBtn = document.getElementById('cancelSettings');
    const saveBtn = document.getElementById('saveSettings');
    
    if (!modal || !settingsBtn) return;
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
    document.getElementById('ktgExcellent').value = settings.ktgThresholds.excellent;
    document.getElementById('ktgGood').value = settings.ktgThresholds.good;
    document.getElementById('ktgPoor').value = settings.ktgThresholds.good;
    document.getElementById('sensorPeriodType').value = settings.sensorPeriodType;
    document.getElementById('sensorMonths').value = settings.sensorMonths;
    document.getElementById('monitoringPeriod').value = settings.monitoringPeriod;
    document.getElementById('noTruckGradientType').value = settings.noTruckGradientType;
    
    document.getElementById('tkvchGreenLower').value = settings.tkvchThresholds.greenLower;
    document.getElementById('tkvchGreenUpper').value = settings.tkvchThresholds.greenUpper;
    document.getElementById('tkvchYellowLower').value = settings.tkvchThresholds.yellowLower;
    document.getElementById('tkvchYellowUpper').value = settings.tkvchThresholds.yellowUpper;
    document.getElementById('tkvchRedLower').value = settings.tkvchThresholds.redLower;
    document.getElementById('tkvchRedUpper').value = settings.tkvchThresholds.redUpper;
    
    document.getElementById('pressureGreenLower').value = settings.pressureThresholds.greenLower;
    document.getElementById('pressureGreenUpper').value = settings.pressureThresholds.greenUpper;
    document.getElementById('pressureYellowLower').value = settings.pressureThresholds.yellowLower;
    document.getElementById('pressureYellowUpper').value = settings.pressureThresholds.yellowUpper;
    document.getElementById('pressureRedLower').value = settings.pressureThresholds.redLower;
    document.getElementById('pressureRedUpper').value = settings.pressureThresholds.redUpper;
    
    document.getElementById('noPlanAnimation').value = settings.noPlanAnimation;
    
    document.getElementById('noTruckGradientStart').value = settings.colors.noTruckGradientStart;
    document.getElementById('noTruckGradientEnd').value = settings.colors.noTruckGradientEnd;
    document.getElementById('noPlanColor').value = settings.colors.noPlanColor;
    document.getElementById('excellentColor').value = settings.colors.excellent;
    document.getElementById('goodColor').value = settings.colors.good;
    document.getElementById('poorColor').value = settings.colors.poor;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    updateColorPreviews();
    updateThresholdPreviews();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    document.getElementById('noTruckGradientStart').addEventListener('input', updateColorPreviews);
    document.getElementById('noTruckGradientEnd').addEventListener('input', updateColorPreviews);
    document.getElementById('noPlanColor').addEventListener('input', updateColorPreviews);
    document.getElementById('excellentColor').addEventListener('input', updateColorPreviews);
    document.getElementById('goodColor').addEventListener('input', updateColorPreviews);
    document.getElementById('poorColor').addEventListener('input', updateColorPreviews);
    document.getElementById('noTruckGradientType').addEventListener('change', updateColorPreviews);
    
    document.getElementById('ktgExcellent').addEventListener('input', updateThresholdPreviews);
    document.getElementById('ktgGood').addEventListener('input', updateThresholdPreviews);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    settingsBtn.addEventListener('click', () => modal.classList.add('active'));
    closeBtn.addEventListener('click', () => modal.classList.remove('active'));
    cancelBtn.addEventListener('click', () => modal.classList.remove('active'));
    
    saveBtn.addEventListener('click', () => {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        settings.ktgThresholds.excellent = parseInt(document.getElementById('ktgExcellent').value);
        settings.ktgThresholds.good = parseInt(document.getElementById('ktgGood').value);
        settings.sensorPeriodType = document.getElementById('sensorPeriodType').value;
        settings.sensorMonths = parseInt(document.getElementById('sensorMonths').value);
        settings.startDate = document.getElementById('startDate').value;
        settings.endDate = document.getElementById('endDate').value;
        settings.monitoringPeriod = parseInt(document.getElementById('monitoringPeriod').value);
        settings.noTruckGradientType = document.getElementById('noTruckGradientType').value;
        
        settings.tkvchThresholds.greenLower = parseInt(document.getElementById('tkvchGreenLower').value);
        settings.tkvchThresholds.greenUpper = parseInt(document.getElementById('tkvchGreenUpper').value);
        settings.tkvchThresholds.yellowLower = parseInt(document.getElementById('tkvchYellowLower').value);
        settings.tkvchThresholds.yellowUpper = parseInt(document.getElementById('tkvchYellowUpper').value);
        settings.tkvchThresholds.redLower = parseInt(document.getElementById('tkvchRedLower').value);
        settings.tkvchThresholds.redUpper = parseInt(document.getElementById('tkvchRedUpper').value);
        
        settings.pressureThresholds.greenLower = parseFloat(document.getElementById('pressureGreenLower').value);
        settings.pressureThresholds.greenUpper = parseFloat(document.getElementById('pressureGreenUpper').value);
        settings.pressureThresholds.yellowLower = parseFloat(document.getElementById('pressureYellowLower').value);
        settings.pressureThresholds.yellowUpper = parseFloat(document.getElementById('pressureYellowUpper').value);
        settings.pressureThresholds.redLower = parseFloat(document.getElementById('pressureRedLower').value);
        settings.pressureThresholds.redUpper = parseFloat(document.getElementById('pressureRedUpper').value);
        
        settings.noPlanAnimation = document.getElementById('noPlanAnimation').value;
        
        settings.colors.noTruckGradientStart = document.getElementById('noTruckGradientStart').value;
        settings.colors.noTruckGradientEnd = document.getElementById('noTruckGradientEnd').value;
        settings.colors.noPlanColor = document.getElementById('noPlanColor').value;
        settings.colors.excellent = document.getElementById('excellentColor').value;
        settings.colors.good = document.getElementById('goodColor').value;
        settings.colors.poor = document.getElementById('poorColor').value;
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ CSS
        applySettingsToCSS();
        
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        renderStatsTable();
        renderTrucksTable();
        
        modal.classList.remove('active');
        showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
    });
}

/* === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –ø–µ—á–∞—Ç–∏ === */
function initExportModal() {
    const modal = document.getElementById('exportModal');
    const exportBtn = document.getElementById('exportBtn');
    const closeBtn = document.getElementById('closeExportModal');
    const cancelBtn = document.getElementById('cancelExport');
    const confirmBtn = document.getElementById('confirmExport');
    
    if (!modal || !exportBtn) return;
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    exportBtn.addEventListener('click', () => modal.classList.add('active'));
    closeBtn.addEventListener('click', () => modal.classList.remove('active'));
    cancelBtn.addEventListener('click', () => modal.classList.remove('active'));
    
    confirmBtn.addEventListener('click', () => {
        const fileName = document.getElementById('exportFileName').value;
        const exportFormat = document.getElementById('exportFormat').value;
        
        showNotification(`–≠–∫—Å–ø–æ—Ä—Ç –≤ ${exportFormat.toUpperCase()} –≤—ã–ø–æ–ª–Ω–µ–Ω: ${fileName}`, 'success');
        modal.classList.remove('active');
    });
}

function initPrintModal() {
    const modal = document.getElementById('printModal');
    const printBtn = document.getElementById('printBtn');
    const closeBtn = document.getElementById('closePrintModal');
    const cancelBtn = document.getElementById('cancelPrint');
    const confirmBtn = document.getElementById('confirmPrint');
    
    if (!modal || !printBtn) return;
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    printBtn.addEventListener('click', () => modal.classList.add('active'));
    closeBtn.addEventListener('click', () => modal.classList.remove('active'));
    cancelBtn.addEventListener('click', () => modal.classList.remove('active'));
    
    confirmBtn.addEventListener('click', () => {
        const printer = document.getElementById('printerSelect').value;
        const printRange = document.getElementById('printRange').value;
        const copies = document.getElementById('copies').value;
        
        showNotification(`–ü–µ—á–∞—Ç—å –Ω–∞ ${printer} (${copies} –∫–æ–ø–∏–π, ${printRange})`, 'success');
        modal.classList.remove('active');
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏
        setTimeout(() => {
            window.print();
        }, 500);
    });
}

/* === –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤ === */
function updateColorPreviews() {
    const gradientType = document.getElementById('noTruckGradientType').value;
    const startColor = document.getElementById('noTruckGradientStart').value;
    const endColor = document.getElementById('noTruckGradientEnd').value;
    
    if (gradientType === 'gradient') {
        document.getElementById('noTruckGradientStartPreview').style.background = 
            `linear-gradient(135deg, ${startColor}, ${endColor})`;
        document.getElementById('noTruckGradientEndPreview').style.background = 
            `linear-gradient(135deg, ${startColor}, ${endColor})`;
    } else if (gradientType === 'solid') {
        document.getElementById('noTruckGradientStartPreview').style.backgroundColor = startColor;
        document.getElementById('noTruckGradientEndPreview').style.backgroundColor = startColor;
    } else {
        document.getElementById('noTruckGradientStartPreview').style.background = 
            `repeating-linear-gradient(45deg, ${startColor}, ${startColor} 4px, ${endColor} 4px, ${endColor} 8px)`;
        document.getElementById('noTruckGradientEndPreview').style.background = 
            `repeating-linear-gradient(45deg, ${startColor}, ${startColor} 4px, ${endColor} 4px, ${endColor} 8px)`;
    }
    
    document.getElementById('noPlanColorPreview').style.backgroundColor = document.getElementById('noPlanColor').value;
    document.getElementById('excellentColorPreview').style.backgroundColor = document.getElementById('excellentColor').value;
    document.getElementById('goodColorPreview').style.backgroundColor = document.getElementById('goodColor').value;
    document.getElementById('poorColorPreview').style.backgroundColor = document.getElementById('poorColor').value;
    
    const animationPreview = document.getElementById('animationPreview');
    if (animationPreview) {
        animationPreview.style.animation = 'border-pulse-inner 1.5s infinite';
        animationPreview.style.setProperty('--no-plan-color', document.getElementById('noPlanColor').value);
    }
}

/* === –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ—Ä–æ–≥–æ–≤ === */
function updateThresholdPreviews() {
    const ktgExcellent = parseInt(document.getElementById('ktgExcellent').value) || 95;
    const ktgGood = parseInt(document.getElementById('ktgGood').value) || 80;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ö–¢–ì
    const ktgBar = document.getElementById('ktgThresholdBar');
    if (ktgBar) {
        ktgBar.style.background = `linear-gradient(to right, var(--poor-color) 0%, var(--poor-color) ${ktgGood}%, var(--good-color) ${ktgGood}%, var(--good-color) ${ktgExcellent}%, var(--excellent-color) ${ktgExcellent}%, var(--excellent-color) 100%)`;
    }
    
    document.getElementById('ktgPoor').value = ktgGood;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¢–ö–í–ß
    const tkvchGreenLower = parseInt(document.getElementById('tkvchGreenLower').value) || -50;
    const tkvchGreenUpper = parseInt(document.getElementById('tkvchGreenUpper').value) || 50;
    const tkvchYellowLower = parseInt(document.getElementById('tkvchYellowLower').value) || -100;
    const tkvchYellowUpper = parseInt(document.getElementById('tkvchYellowUpper').value) || 100;
    
    const tkvchBar = document.getElementById('tkvchThresholdBar');
    if (tkvchBar) {
        const totalRange = 300; // –æ—Ç -150 –¥–æ +150
        const greenStart = (tkvchGreenLower + 150) / totalRange * 100;
        const greenEnd = (tkvchGreenUpper + 150) / totalRange * 100;
        const yellowStart = (tkvchYellowLower + 150) / totalRange * 100;
        const yellowEnd = (tkvchYellowUpper + 150) / totalRange * 100;
        
        tkvchBar.style.background = `linear-gradient(to right, 
            var(--poor-color) 0%, var(--poor-color) ${yellowStart}%,
            var(--good-color) ${yellowStart}%, var(--good-color) ${greenStart}%,
            var(--excellent-color) ${greenStart}%, var(--excellent-color) ${greenEnd}%,
            var(--good-color) ${greenEnd}%, var(--good-color) ${yellowEnd}%,
            var(--poor-color) ${yellowEnd}%, var(--poor-color) 100%)`;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–≤–ª–µ–Ω–∏—è
    const pressureGreenLower = parseFloat(document.getElementById('pressureGreenLower').value) || -0.3;
    const pressureGreenUpper = parseFloat(document.getElementById('pressureGreenUpper').value) || 0.3;
    const pressureYellowLower = parseFloat(document.getElementById('pressureYellowLower').value) || -0.6;
    const pressureYellowUpper = parseFloat(document.getElementById('pressureYellowUpper').value) || 0.6;
    
    const pressureBar = document.getElementById('pressureThresholdBar');
    if (pressureBar) {
        const totalRange = 2.0; // –æ—Ç -1.0 –¥–æ +1.0
        const greenStart = (pressureGreenLower + 1.0) / totalRange * 100;
        const greenEnd = (pressureGreenUpper + 1.0) / totalRange * 100;
        const yellowStart = (pressureYellowLower + 1.0) / totalRange * 100;
        const yellowEnd = (pressureYellowUpper + 1.0) / totalRange * 100;
        
        pressureBar.style.background = `linear-gradient(to right, 
            var(--poor-color) 0%, var(--poor-color) ${yellowStart}%,
            var(--good-color) ${yellowStart}%, var(--good-color) ${greenStart}%,
            var(--excellent-color) ${greenStart}%, var(--excellent-color) ${greenEnd}%,
            var(--good-color) ${greenEnd}%, var(--good-color) ${yellowEnd}%,
            var(--poor-color) ${yellowEnd}%, var(--poor-color) 100%)`;
    }
}

/* === –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è === */
function showNotification(message, type = 'success', duration = 2500){
    const n = document.createElement('div'); 
    n.className = `notification ${type}`; 
    n.textContent = message; 
    document.body.appendChild(n);
    setTimeout(() => {
        n.style.opacity = '0'; 
        setTimeout(() => {
            if (document.body.contains(n)) {
                document.body.removeChild(n);
            }
        }, 300);
    }, duration);
}

/* === –ù–∞–≤–∏–≥–∞—Ü–∏—è === */
function navigateTo(section){
    const pages = {
        engineer: 'engineer.html',
        analytics: 'analytics.html',
        forecast: 'forecast.html',
        constructor: 'constructor.html',
        quality: 'quality.html',
        documents: 'documents.html'
    };
    if (pages[section]) {
        window.location.href = pages[section]; 
    } else {
        alert(`–†–∞–∑–¥–µ–ª "${section}" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`);
    }
    document.getElementById('menuDropdown').classList.remove('show');
}

/* === –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è === */
function initControls(){
    // –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    const refreshBtn = document.getElementById('manualRefreshBtn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', () => {
            trucksData = generateTruckList();
            statsData = generateStatsData();
            renderTrucksTable();
            renderStatsTable();
            renderStatsChart();
            const lastUpdateInfo = document.getElementById('lastUpdateInfo');
            if (lastUpdateInfo) {
                lastUpdateInfo.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString()} (–∞–≤—Ç–æ: 5 –º–∏–Ω)`;
            }
            showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Ä—É—á–Ω—É—é','success');
        });
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    initMenu();
    initFilters();
    initChartControls();
    initSettingsModal();
    initExportModal();
    initPrintModal();
    initAdaptiveTooltips();
    applySettingsToCSS();
    updateThresholdPreviews();
}

/* === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ === */
document.addEventListener('DOMContentLoaded', () => {
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    trucksData = generateTruckList();
    statsData = generateStatsData();
    
    // –†–µ–Ω–¥–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    renderTrucksTable();
    renderStatsTable();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
    initSorting();
    initControls();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
    renderStatsChart();
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    const lastUpdateInfo = document.getElementById('lastUpdateInfo');
    if (lastUpdateInfo) {
        lastUpdateInfo.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString()} (–∞–≤—Ç–æ: 5 –º–∏–Ω)`;
    }
    
    console.log('–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
});
</script>
</body>
</html>
